# ğŸ“š LuaåŸºç¡€åº“æ·±åº¦è§£æ - DeepWikiç‰ˆæœ¬

## ğŸ¯ å­¦ä¹ ç›®æ ‡ä¸æŠ€èƒ½å›¾è°±

### ğŸŒŸ æ ¸å¿ƒå­¦ä¹ ç›®æ ‡
é€šè¿‡æœ¬æ–‡æ¡£çš„ç³»ç»Ÿå­¦ä¹ ï¼Œæ‚¨å°†å…¨é¢æŒæ¡ï¼š

- ğŸ—ï¸ **åŸºç¡€åº“è®¾è®¡ç†å¿µ**ï¼šç†è§£Luaæ ¸å¿ƒåŠŸèƒ½çš„æ•´ä½“æ¶æ„å’Œè®¾è®¡æ€æƒ³
- ğŸ”§ **æ ¸å¿ƒå‡½æ•°å®ç°**ï¼šæ·±å…¥æŒæ¡ç±»å‹è½¬æ¢ã€é”™è¯¯å¤„ç†ã€è¾“å‡ºè°ƒè¯•ç­‰å…³é”®å‡½æ•°
- ğŸ¯ **å…ƒç¼–ç¨‹æœºåˆ¶**ï¼šç²¾é€šå…ƒè¡¨æ“ä½œã€ç¯å¢ƒç®¡ç†ã€åŸå§‹æ“ä½œç­‰é«˜çº§ç‰¹æ€§
- âš¡ **æ€§èƒ½ä¼˜åŒ–æŠ€å·§**ï¼šå­¦ä¼šåƒåœ¾å›æ”¶æ§åˆ¶å’Œæ€§èƒ½è°ƒä¼˜æ–¹æ³•
- ğŸ› ï¸ **å®æˆ˜åº”ç”¨èƒ½åŠ›**ï¼šå…·å¤‡åœ¨å®é™…é¡¹ç›®ä¸­çµæ´»è¿ç”¨åŸºç¡€åº“çš„èƒ½åŠ›

### ğŸ“š æŠ€èƒ½å‘å±•è·¯å¾„

```mermaid
graph TB
    subgraph "ğŸ“š LuaåŸºç¡€åº“å­¦ä¹ è·¯å¾„"
        A[ğŸ¯ åŸºç¡€æ¦‚å¿µç†è§£] --> B[ğŸ”§ æ ¸å¿ƒå‡½æ•°æŒæ¡]
        B --> C[ğŸ­ å…ƒç¼–ç¨‹è¿›é˜¶]
        C --> D[âš¡ æ€§èƒ½ä¼˜åŒ–]
        D --> E[ğŸš€ å®æˆ˜åº”ç”¨]
        
        F[ğŸ“– ç†è®ºå­¦ä¹ ] --> G[ğŸ” æºç åˆ†æ]
        G --> H[ğŸ§ª å®éªŒéªŒè¯]
        H --> I[ğŸ’¡ åˆ›æ–°åº”ç”¨]
        
        J[ğŸŒ± åŸºç¡€çº§] --> K[ğŸ”§ è¿›é˜¶çº§]
        K --> L[âš¡ ä¸“å®¶çº§]
    end
    
    style A fill:#e3f2fd
    style E fill:#c8e6c9
    style L fill:#ffecb3
```

### ğŸ“ æŠ€èƒ½ç­‰çº§è¯„ä¼°

| ç­‰çº§ | æŠ€èƒ½æè¿° | å­¦ä¹ å†…å®¹ | å®è·µè¦æ±‚ |
|------|----------|----------|----------|
| ğŸŒ± **åŸºç¡€çº§** | ç†Ÿæ‚‰åŸºç¡€åº“å‡½æ•°ç”¨æ³• | å¸¸ç”¨å‡½æ•°ã€åŸºæœ¬æ¦‚å¿µ | èƒ½æ­£ç¡®ä½¿ç”¨åŸºç¡€åº“å‡½æ•° |
| ğŸ”§ **è¿›é˜¶çº§** | ç†è§£å‡½æ•°å®ç°åŸç† | å†…éƒ¨æœºåˆ¶ã€è®¾è®¡æ€æƒ³ | èƒ½åˆ†æå’Œæ‰©å±•åŠŸèƒ½ |
| âš¡ **ä¸“å®¶çº§** | ç²¾é€šå…ƒç¼–ç¨‹å’Œä¼˜åŒ– | é«˜çº§ç‰¹æ€§ã€æ€§èƒ½è°ƒä¼˜ | èƒ½è®¾è®¡å¤æ‚çš„å…ƒç¼–ç¨‹ç³»ç»Ÿ |

---

## ğŸ§­ æ™ºèƒ½å¯¼èˆªç³»ç»Ÿ

### ğŸ“‹ å¿«é€Ÿå¯¼èˆªç›®å½•

| ç« èŠ‚ | å†…å®¹æ¦‚è§ˆ | é¢„è®¡å­¦ä¹ æ—¶é—´ | éš¾åº¦ç­‰çº§ |
|------|----------|-------------|----------|
| [ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡](#ğŸ—ï¸-æ•´ä½“æ¶æ„è®¾è®¡) | åŸºç¡€åº“è®¾è®¡ç†å¿µä¸ç»„ç»‡ç»“æ„ | 20åˆ†é’Ÿ | â­â­ |
| [ğŸ”§ æ ¸å¿ƒå‡½æ•°åˆ†æ](#ğŸ”§-æ ¸å¿ƒå‡½æ•°æ·±åº¦åˆ†æ) | ç±»å‹è½¬æ¢ã€è¾“å‡ºã€é”™è¯¯å¤„ç†å‡½æ•° | 35åˆ†é’Ÿ | â­â­â­ |
| [ğŸ­ å…ƒç¼–ç¨‹æœºåˆ¶](#ğŸ­-å…ƒç¼–ç¨‹æœºåˆ¶æ·±åº¦è§£æ) | å…ƒè¡¨ã€ç¯å¢ƒã€åŸå§‹æ“ä½œè¯¦è§£ | 40åˆ†é’Ÿ | â­â­â­â­ |
| [âš¡ æ€§èƒ½ä¸ä¼˜åŒ–](#âš¡-æ€§èƒ½ä¼˜åŒ–ä¸é«˜çº§åº”ç”¨) | åƒåœ¾å›æ”¶æ§åˆ¶ä¸æ€§èƒ½è°ƒä¼˜ | 25åˆ†é’Ÿ | â­â­â­â­ |
| [ğŸŒŸ å®æˆ˜åº”ç”¨](#ğŸŒŸ-å®æˆ˜åº”ç”¨ä¸æ‰©å±•å¼€å‘) | å®é™…é¡¹ç›®åº”ç”¨ä¸æ‰©å±•æŠ€å·§ | 20åˆ†é’Ÿ | â­â­â­ |

### ğŸ¯ å­¦ä¹ è·¯å¾„æ¨è

#### ğŸš€ å¿«é€Ÿä¸Šæ‰‹è·¯å¾„ (40åˆ†é’Ÿ)
```
ğŸ—ï¸ æ•´ä½“æ¶æ„ â†’ ğŸ”§ æ ¸å¿ƒå‡½æ•°åŸºç¡€ â†’ ğŸŒŸ å®æˆ˜åº”ç”¨
```

#### ğŸ“š æ·±åº¦å­¦ä¹ è·¯å¾„ (2.5å°æ—¶)  
```
ğŸ—ï¸ æ¶æ„è®¾è®¡ â†’ ğŸ”§ æ ¸å¿ƒå‡½æ•° â†’ ğŸ­ å…ƒç¼–ç¨‹ â†’ âš¡ æ€§èƒ½ä¼˜åŒ– â†’ ğŸŒŸ å®æˆ˜åº”ç”¨
```

#### ğŸ¯ ä¸“é¡¹çªç ´è·¯å¾„
- **ğŸ”§ å‡½æ•°å®ç°ä¸“ç²¾**ï¼šğŸ—ï¸ æ¶æ„ â†’ ğŸ”§ æ ¸å¿ƒå‡½æ•° â†’ âš¡ æ€§èƒ½ä¼˜åŒ–
- **ğŸ­ å…ƒç¼–ç¨‹ä¸“ç²¾**ï¼šğŸ—ï¸ æ¶æ„ â†’ ğŸ­ å…ƒç¼–ç¨‹ â†’ ğŸŒŸ å®æˆ˜åº”ç”¨
- **âš¡ æ€§èƒ½ä¸“ç²¾**ï¼šğŸ”§ æ ¸å¿ƒå‡½æ•° â†’ âš¡ æ€§èƒ½ä¼˜åŒ– â†’ ğŸŒŸ å®æˆ˜åº”ç”¨

---

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### ğŸ¯ LuaåŸºç¡€åº“è®¾è®¡ç†å¿µ

LuaåŸºç¡€åº“(lbaselib.c)æ˜¯Luaè¯­è¨€çš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼Œå®ƒä½“ç°äº†Lua"ç®€æ´è€Œå¼ºå¤§"çš„è®¾è®¡å“²å­¦ã€‚

#### ğŸŒŸ è®¾è®¡æ ¸å¿ƒåŸåˆ™
```mermaid
graph TB
    subgraph "ğŸ—ï¸ LuaåŸºç¡€åº“è®¾è®¡åŸåˆ™"
        A[ğŸ¯ ç®€æ´æ€§åŸåˆ™] --> B[ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½èšç„¦]
        A --> C[âš¡ é«˜æ•ˆå®ç°]
        A --> D[ğŸ” æœ€å°ä¾èµ–]
        
        E[ğŸ”§ ä¸€è‡´æ€§åŸåˆ™] --> F[ğŸ“Š ç»Ÿä¸€æ¥å£è®¾è®¡]
        E --> G[ğŸ’¾ ç»Ÿä¸€é”™è¯¯å¤„ç†]
        E --> H[ğŸ­ ç»Ÿä¸€å‘½åè§„èŒƒ]
        
        I[ğŸš€ æ‰©å±•æ€§åŸåˆ™] --> J[ğŸ“ å…ƒç¼–ç¨‹æ”¯æŒ]
        I --> K[ğŸ”¤ ç¯å¢ƒå®šåˆ¶åŒ–]
        I --> L[âš¡ æ€§èƒ½å¯æ§åˆ¶]
    end
    
    style A fill:#4caf50
    style E fill:#ff9800
    style I fill:#2196f3
```

#### ğŸ“Š åŠŸèƒ½æ¨¡å—æ¶æ„å›¾
```mermaid
graph LR
    subgraph "ğŸ“š LuaåŸºç¡€åº“åŠŸèƒ½æ¶æ„"
        A["ğŸ”§ æ ¸å¿ƒå‡½æ•°ç»„<br/>Core Functions"] --> B["ğŸ¯ ç±»å‹ç³»ç»Ÿ<br/>Type System"]
        A --> C["ğŸ“¤ è¾“å‡ºè°ƒè¯•<br/>Output & Debug"]
        A --> D["ğŸš¨ é”™è¯¯å¤„ç†<br/>Error Handling"]
        
        E["ğŸ­ å…ƒç¼–ç¨‹ç»„<br/>Metaprogramming"] --> F["ğŸ“‹ å…ƒè¡¨æ“ä½œ<br/>Metatable Ops"]
        E --> G["ğŸŒ ç¯å¢ƒç®¡ç†<br/>Environment"]
        E --> H["ğŸ”„ åŸå§‹æ“ä½œ<br/>Raw Operations"]
        
        I["âš¡ æ§åˆ¶ç»„<br/>Control Group"] --> J["ğŸ—‘ï¸ åƒåœ¾å›æ”¶<br/>GC Control"]
        I --> K["ğŸ” è¿­ä»£å™¨<br/>Iterators"]
        I --> L["ğŸ›¡ï¸ ä¿æŠ¤è°ƒç”¨<br/>Protected Call"]
    end
    
    style A fill:#e3f2fd
    style E fill:#f3e5f5
    style I fill:#e8f5e8
```

### ğŸª åŸºç¡€åº“çš„æ ¸å¿ƒèŒè´£

#### ğŸ“‹ ä¸»è¦åŠŸèƒ½åŸŸ
| åŠŸèƒ½åŸŸ | æ ¸å¿ƒèŒè´£ | å…³é”®å‡½æ•° | è®¾è®¡ç‰¹ç‚¹ |
|--------|----------|----------|----------|
| ğŸ”§ **ç±»å‹æ“ä½œ** | ç±»å‹è½¬æ¢ä¸æ£€æŸ¥ | `type`, `tonumber`, `tostring` | ç±»å‹å®‰å…¨ï¼Œæ€§èƒ½ä¼˜å…ˆ |
| ğŸ“¤ **è¾“å‡ºè°ƒè¯•** | è°ƒè¯•ä¿¡æ¯è¾“å‡º | `print` | ç®€æ´æ˜“ç”¨ï¼Œæ ¼å¼åŒ–è¾“å‡º |
| ğŸš¨ **é”™è¯¯å¤„ç†** | å¼‚å¸¸å¤„ç†æœºåˆ¶ | `error`, `assert`, `pcall`, `xpcall` | å±‚æ¬¡åŒ–é”™è¯¯ï¼Œä¿æŠ¤æ‰§è¡Œ |
| ğŸ­ **å…ƒç¼–ç¨‹** | åå°„å’Œå…ƒæ“ä½œ | `getmetatable`, `setmetatable`, `rawget` | å¼ºå¤§çµæ´»ï¼Œå®‰å…¨å¯æ§ |
| ğŸŒ **ç¯å¢ƒæ§åˆ¶** | æ‰§è¡Œç¯å¢ƒç®¡ç† | `getfenv`, `setfenv` | åŠ¨æ€ç¯å¢ƒï¼Œå®‰å…¨éš”ç¦» |
| âš¡ **æ€§èƒ½æ§åˆ¶** | èµ„æºç®¡ç†ä¼˜åŒ– | `collectgarbage` | ç²¾ç¡®æ§åˆ¶ï¼Œæ€§èƒ½å¯è°ƒ |

#### ğŸ’¡ è®¾è®¡ä¼˜åŠ¿åˆ†æ
1. **ğŸ¯ èŒè´£æ˜ç¡®**ï¼šæ¯ä¸ªå‡½æ•°éƒ½æœ‰æ¸…æ™°å®šä¹‰çš„å•ä¸€èŒè´£
2. **âš¡ æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¸å¿ƒè·¯å¾„é«˜åº¦ä¼˜åŒ–ï¼Œæœ€å°åŒ–å¼€é”€
3. **ğŸ”§ æ˜“äºæ‰©å±•**ï¼šæ¨¡å—åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•
4. **ğŸ›¡ï¸ é”™è¯¯å‹å¥½**ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ”¯æŒ
5. **ğŸ­ å…ƒç¼–ç¨‹å¼ºå¤§**ï¼šæä¾›ä¸°å¯Œçš„åå°„å’Œå…ƒæ“ä½œèƒ½åŠ›

### ğŸ”„ åŸºç¡€åº“åˆå§‹åŒ–æµç¨‹

#### ğŸš€ å®Œæ•´åˆå§‹åŒ–è¿‡ç¨‹
```mermaid
graph TB
    subgraph "ğŸ”„ åŸºç¡€åº“åˆå§‹åŒ–æµç¨‹"
        A[ğŸ¯ LuaçŠ¶æ€æœºåˆ›å»º] --> B[ğŸ“š åŸºç¡€åº“æ³¨å†Œ]
        B --> C[ğŸ“‹ å‡½æ•°è¡¨æ„å»º]
        C --> D[ğŸŒ å…¨å±€ç¯å¢ƒè®¾ç½®]
        
        D --> E{ğŸ” å‡½æ•°ç±»å‹åˆ†ç±»}
        E -->|æ ¸å¿ƒå‡½æ•°| F[ğŸ”§ ç›´æ¥æ³¨å†Œåˆ°_G]
        E -->|è¿­ä»£å™¨| G[ğŸ” åˆ›å»ºé—­åŒ…upvalue]
        E -->|ç‰¹æ®Šå‡½æ•°| H[ğŸ¯ ç‰¹æ®Šå¤„ç†é€»è¾‘]
        
        F --> I[âœ… æ³¨å†Œå®Œæˆ]
        G --> I
        H --> I
        
        I --> J[ğŸ“Š ç‰ˆæœ¬ä¿¡æ¯è®¾ç½®]
        J --> K[ğŸš€ åŸºç¡€åº“å¯ç”¨]
    end
    
    style A fill:#e3f2fd
    style K fill:#c8e6c9
    style E fill:#fff3e0
```

#### ğŸ—ï¸ å‡½æ•°æ³¨å†Œæœºåˆ¶è¯¦è§£
```c
/* ğŸ¯ åŸºç¡€åº“å‡½æ•°æ³¨å†Œè¡¨ */
static const luaL_Reg base_funcs[] = {
  /*
  æ³¨å†Œè¡¨è®¾è®¡è¦ç‚¹ï¼š
  
  1. ğŸ“‹ é™æ€è¡¨ç»“æ„ï¼šç¼–è¯‘æ—¶ç¡®å®šï¼Œè¿è¡Œæ—¶é«˜æ•ˆ
  2. ğŸ¯ å‡½æ•°æŒ‡é’ˆæ˜ å°„ï¼šç›´æ¥æŒ‡å‘Cå‡½æ•°å®ç°
  3. ğŸ”¤ å­—ç¬¦ä¸²é”®åï¼šä¸Luaä¸­çš„å‡½æ•°åä¿æŒä¸€è‡´
  4. ğŸ”š NULLç»ˆç»“ç¬¦ï¼šæ ‡è®°æ•°ç»„ç»“æŸ
  */
  
  {"assert", luaB_assert},           // ğŸ›¡ï¸ æ–­è¨€æ£€æŸ¥
  {"collectgarbage", luaB_collectgarbage}, // ğŸ—‘ï¸ åƒåœ¾å›æ”¶æ§åˆ¶
  {"error", luaB_error},             // ğŸš¨ é”™è¯¯æŠ›å‡º
  {"getmetatable", luaB_getmetatable}, // ğŸ“‹ è·å–å…ƒè¡¨
  {"next", luaB_next},               // ğŸ” è¡¨éå†
  {"pairs", luaB_pairs},             // ğŸ”„ é”®å€¼å¯¹è¿­ä»£
  {"pcall", luaB_pcall},             // ğŸ›¡ï¸ ä¿æŠ¤è°ƒç”¨
  {"print", luaB_print},             // ğŸ“¤ è¾“å‡ºæ‰“å°
  {"rawget", luaB_rawget},           // ğŸ”„ åŸå§‹è·å–
  {"setmetatable", luaB_setmetatable}, // ğŸ“ è®¾ç½®å…ƒè¡¨
  {"tonumber", luaB_tonumber},       // ğŸ”¢ æ•°å­—è½¬æ¢
  {"tostring", luaB_tostring},       // ğŸ“ å­—ç¬¦ä¸²è½¬æ¢
  {"type", luaB_type},               // ğŸ·ï¸ ç±»å‹æ£€æŸ¥
  {"xpcall", luaB_xpcall},           // ğŸ›¡ï¸ æ‰©å±•ä¿æŠ¤è°ƒç”¨
  {NULL, NULL}                       // ğŸ”š ç»“æŸæ ‡è®°
};

/* ğŸ“š åŸºç¡€åº“å¼€æ”¾å‡½æ•° */
LUAMOD_API int luaopen_base (lua_State *L) {
  /*
  åˆå§‹åŒ–æµç¨‹ï¼š
  
  1. ğŸŒ è·å–å…¨å±€ç¯å¢ƒè¡¨
  2. ğŸ“‹ æ‰¹é‡æ³¨å†Œæ‰€æœ‰å‡½æ•°
  3. ğŸ“Š è®¾ç½®ç‰ˆæœ¬ä¿¡æ¯
  4. âœ… è¿”å›æ³¨å†ŒæˆåŠŸ
  */
  
  lua_pushvalue(L, LUA_GLOBALSINDEX);      // ğŸŒ æ¨å…¥å…¨å±€è¡¨
  luaL_register(L, "_G", base_funcs);      // ğŸ“‹ æ³¨å†Œå‡½æ•°åˆ°_G
  lua_pushliteral(L, LUA_VERSION);         // ğŸ“Š æ¨å…¥ç‰ˆæœ¬å­—ç¬¦ä¸²
  lua_setglobal(L, "_VERSION");            // ğŸ·ï¸ è®¾ç½®_VERSIONå…¨å±€å˜é‡
  return 1;                                // âœ… è¿”å›å…¨å±€è¡¨
}

/*
ğŸ¯ åˆå§‹åŒ–è®¾è®¡äº®ç‚¹ï¼š
- ğŸ“Š æ‰¹é‡æ³¨å†Œï¼šä¸€æ¬¡æ€§æ³¨å†Œæ‰€æœ‰å‡½æ•°ï¼Œé«˜æ•ˆç®€æ´
- ğŸŒ å…¨å±€å¯ç”¨ï¼šå‡½æ•°ç›´æ¥æ³¨å†Œåˆ°å…¨å±€ç¯å¢ƒï¼Œæ— éœ€require
- ğŸ“‹ ç‰ˆæœ¬è·Ÿè¸ªï¼šè‡ªåŠ¨è®¾ç½®ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¾¿äºå…¼å®¹æ€§æ£€æŸ¥
- ğŸ’¾ å†…å­˜å‹å¥½ï¼šé™æ€è¡¨ç»“æ„ï¼Œæ— éœ€åŠ¨æ€åˆ†é…å†…å­˜
*/
```

## ğŸ”§ æ ¸å¿ƒå‡½æ•°æ·±åº¦åˆ†æ

### ğŸ¯ å‡½æ•°åˆ†ç±»ä½“ç³»

LuaåŸºç¡€åº“çš„å‡½æ•°å¯ä»¥æŒ‰ç…§åŠŸèƒ½å’Œä½¿ç”¨åœºæ™¯è¿›è¡Œç³»ç»ŸåŒ–åˆ†ç±»ï¼š

#### ğŸ“Š åŠŸèƒ½åˆ†ç±»æ¶æ„
```mermaid
graph TB
    subgraph "ğŸ”§ LuaåŸºç¡€åº“å‡½æ•°åˆ†ç±»ä½“ç³»"
        A[ğŸ“š åŸºç¡€åº“å‡½æ•°] --> B[ğŸ·ï¸ ç±»å‹æ“ä½œç»„]
        A --> C[ğŸ“¤ è¾“å‡ºè°ƒè¯•ç»„] 
        A --> D[ğŸš¨ é”™è¯¯å¤„ç†ç»„]
        A --> E[ğŸ­ å…ƒç¼–ç¨‹ç»„]
        A --> F[âš¡ æ§åˆ¶æµç»„]
        
        B --> B1[ğŸ”¢ tonumber]
        B --> B2[ğŸ“ tostring]  
        B --> B3[ğŸ·ï¸ type]
        
        C --> C1[ğŸ“¤ print]
        
        D --> D1[ğŸš¨ error]
        D --> D2[ğŸ›¡ï¸ assert]
        D --> D3[ğŸ”’ pcall]
        D --> D4[ğŸ”§ xpcall]
        
        E --> E1[ğŸ“‹ getmetatable]
        E --> E2[ğŸ“ setmetatable]
        E --> E3[ğŸ”„ rawget/rawset]
        E --> E4[ğŸŒ getfenv/setfenv]
        
        F --> F1[ğŸ” next/pairs/ipairs]
        F --> F2[ğŸ—‘ï¸ collectgarbage]
        F --> F3[ğŸ“‹ select/unpack]
    end
    
    style A fill:#e3f2fd
    style B fill:#c8e6c9
    style D fill:#ffcdd2
    style E fill:#f3e5f5
```

#### ğŸª ä½¿ç”¨é¢‘ç‡ä¸é‡è¦æ€§åˆ†æ
| å‡½æ•°ç»„ | ä½¿ç”¨é¢‘ç‡ | é‡è¦ç­‰çº§ | å­¦ä¹ ä¼˜å…ˆçº§ | å…¸å‹åº”ç”¨åœºæ™¯ |
|--------|----------|----------|------------|-------------|
| ğŸ·ï¸ **ç±»å‹æ“ä½œ** | â­â­â­â­â­ | ğŸ”¥ å¿…éœ€ | 1 | æ•°æ®éªŒè¯ã€ç±»å‹è½¬æ¢ã€è°ƒè¯•è¾“å‡º |
| ğŸ“¤ **è¾“å‡ºè°ƒè¯•** | â­â­â­â­â­ | ğŸ”¥ å¿…éœ€ | 1 | è°ƒè¯•ã€æ—¥å¿—è®°å½•ã€ç”¨æˆ·äº¤äº’ |
| ğŸš¨ **é”™è¯¯å¤„ç†** | â­â­â­â­ | ğŸ”¥ é‡è¦ | 2 | å¼‚å¸¸å¤„ç†ã€å¥å£®æ€§ä¿è¯ |
| ğŸ­ **å…ƒç¼–ç¨‹** | â­â­â­ | ğŸ’¡ é«˜çº§ | 3 | æ¡†æ¶å¼€å‘ã€DSLè®¾è®¡ã€OOPå®ç° |
| âš¡ **æ§åˆ¶æµ** | â­â­â­ | âš™ï¸ å·¥å…· | 2 | è¿­ä»£å¤„ç†ã€æ€§èƒ½è°ƒä¼˜ã€æ•°æ®æ“ä½œ |

### ğŸ·ï¸ ç±»å‹ç³»ç»Ÿæ ¸å¿ƒå‡½æ•°

#### ğŸ”¢ tonumberå‡½æ•°æ·±åº¦è§£æ
```c
/* ğŸ”¢ æ•°å­—è½¬æ¢çš„æ™ºèƒ½å®ç° */
static int luaB_tonumber (lua_State *L) {
  /*
  tonumberå‡½æ•°è®¾è®¡è¦ç‚¹ï¼š
  
  1. ğŸ¯ å¤šè¿›åˆ¶æ”¯æŒï¼šæ”¯æŒ2-36è¿›åˆ¶çš„æ•°å­—è½¬æ¢
  2. âš¡ æ€§èƒ½ä¼˜åŒ–ï¼šåè¿›åˆ¶å¿«é€Ÿè·¯å¾„ï¼Œé¿å…å­—ç¬¦ä¸²è§£æ
  3. ğŸ›¡ï¸ é”™è¯¯å¤„ç†ï¼šè½¬æ¢å¤±è´¥è¿”å›nilï¼Œä¸æŠ›å‡ºå¼‚å¸¸
  4. ğŸ” ä¸¥æ ¼éªŒè¯ï¼šç¡®ä¿æ•´ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯æœ‰æ•ˆæ•°å­—
  */
  
  int base = luaL_optint(L, 2, 10);  // ğŸ¯ è·å–è¿›åˆ¶ï¼Œé»˜è®¤åè¿›åˆ¶
  
  if (base == 10) {  /* ğŸš€ åè¿›åˆ¶å¿«é€Ÿè·¯å¾„ */
    luaL_checkany(L, 1);
    if (lua_isnumber(L, 1)) {         // ğŸ” å·²ç»æ˜¯æ•°å­—ï¼Ÿ
      lua_pushnumber(L, lua_tonumber(L, 1));
      return 1;
    }
  }
  else {  /* ğŸ² ä»»æ„è¿›åˆ¶è½¬æ¢ */
    const char *s1 = luaL_checkstring(L, 1);  // ğŸ“ è·å–å­—ç¬¦ä¸²
    char *s2;
    unsigned long n;
    
    luaL_argcheck(L, 2 <= base && base <= 36, 2, "base out of range");
    n = strtoul(s1, &s2, base);       // ğŸ”„ Cåº“è½¬æ¢
    
    if (s1 != s2) {  /* ğŸ“Š è‡³å°‘è½¬æ¢äº†ä¸€ä¸ªå­—ç¬¦ï¼Ÿ */
      while (isspace((unsigned char)(*s2))) s2++;  // â­ï¸ è·³è¿‡å°¾éƒ¨ç©ºæ ¼
      if (*s2 == '\0') {              // ğŸ” æ²¡æœ‰æ— æ•ˆå­—ç¬¦ï¼Ÿ
        lua_pushnumber(L, (lua_Number)n);
        return 1;
      }
    }
  }
  lua_pushnil(L);  /* ğŸš« è½¬æ¢å¤±è´¥è¿”å›nil */
  return 1;
}

/*
ğŸ§  è®¾è®¡æ™ºæ…§è§£æï¼š
- ğŸš€ å¿«é€Ÿè·¯å¾„ï¼šåè¿›åˆ¶æ•°å­—ç›´æ¥è¿”å›ï¼Œé¿å…å­—ç¬¦ä¸²æ“ä½œ
- ğŸ” ä¸¥æ ¼éªŒè¯ï¼šç¡®ä¿å­—ç¬¦ä¸²å®Œå…¨æ˜¯æœ‰æ•ˆæ•°å­—ï¼Œä¸å…è®¸éƒ¨åˆ†è½¬æ¢
- ğŸ¯ è¿›åˆ¶çµæ´»ï¼šæ”¯æŒç¼–ç¨‹ä¸­å¸¸ç”¨çš„å„ç§è¿›åˆ¶ï¼ˆäºŒè¿›åˆ¶ã€å…«è¿›åˆ¶ã€åå…­è¿›åˆ¶ç­‰ï¼‰
- ğŸ›¡ï¸ é”™è¯¯å‹å¥½ï¼šå¤±è´¥æ—¶è¿”å›nilè€ŒéæŠ›å‡ºé”™è¯¯ï¼Œä¾¿äºæ¡ä»¶åˆ¤æ–­
*/
```

#### ğŸ“ tostringå‡½æ•°æ ¸å¿ƒæœºåˆ¶
```mermaid
graph TB
    subgraph "ğŸ“ tostringå‡½æ•°è½¬æ¢æµç¨‹"
        A[ğŸ¯ è¾“å…¥å€¼] --> B{ğŸ” æ£€æŸ¥__tostringå…ƒæ–¹æ³•}
        
        B -->|å­˜åœ¨å…ƒæ–¹æ³•| C[ğŸ­ è°ƒç”¨å…ƒæ–¹æ³•]
        B -->|æ— å…ƒæ–¹æ³•| D{ğŸ·ï¸ å€¼ç±»å‹åˆ¤æ–­}
        
        C --> E[ğŸ“¤ è¿”å›å…ƒæ–¹æ³•ç»“æœ]
        
        D -->|æ•°å­—| F[ğŸ“Š æ•°å­—æ ¼å¼åŒ–]
        D -->|å­—ç¬¦ä¸²| G[ğŸ“ ç›´æ¥è¿”å›]
        D -->|å¸ƒå°”å€¼| H[ğŸ”¤ true/falseå­—ç¬¦ä¸²]
        D -->|nil| I[ğŸ“‹ nilå­—ç¬¦ä¸²]
        D -->|å…¶ä»–| J[ğŸ“ ç±»å‹å+æŒ‡é’ˆåœ°å€]
        
        F --> K[âœ… æœ€ç»ˆå­—ç¬¦ä¸²]
        G --> K
        H --> K
        I --> K
        J --> K
    end
    
    style A fill:#e3f2fd
    style E fill:#c8e6c9
    style K fill:#fff3e0
```

#### ğŸ·ï¸ typeå‡½æ•°çš„ç®€æ´å“²å­¦
```c
/* ğŸ·ï¸ ç±»å‹æ£€æŸ¥çš„æè‡´ç®€æ´ */
static int luaB_type (lua_State *L) {
  /*
  typeå‡½æ•°ä½“ç°äº†Luaçš„ç®€æ´å“²å­¦ï¼š
  
  1. ğŸ¯ å•ä¸€èŒè´£ï¼šåªåšç±»å‹æ£€æŸ¥ï¼Œä¸åšå…¶ä»–å¤„ç†
  2. âš¡ é«˜æ•ˆå®ç°ï¼šç›´æ¥è°ƒç”¨å†…éƒ¨ç±»å‹æ£€æŸ¥å‡½æ•°
  3. ğŸ”¤ æ ‡å‡†è¾“å‡ºï¼šè¿”å›æ ‡å‡†ç±»å‹åå­—ç¬¦ä¸²
  4. ğŸ’¾ é›¶å¼€é”€ï¼šæ— é¢å¤–å†…å­˜åˆ†é…æˆ–å¤æ‚é€»è¾‘
  */
  
  luaL_checkany(L, 1);                    // ğŸ” ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°
  lua_pushstring(L, luaL_typename(L, 1)); // ğŸ·ï¸ æ¨å…¥ç±»å‹åå­—ç¬¦ä¸²
  return 1;                               // ğŸ“¤ è¿”å›ä¸€ä¸ªç»“æœ
}

/*
ğŸ¯ å®ç°äº®ç‚¹ï¼š
- ğŸ“ ä»£ç æç®€ï¼šä»…3è¡Œä»£ç å®Œæˆæ ¸å¿ƒåŠŸèƒ½
- âš¡ æ€§èƒ½æœ€ä¼˜ï¼šç›´æ¥å¤ç”¨VMå†…éƒ¨çš„ç±»å‹æ£€æŸ¥
- ğŸ”¤ æ ‡å‡†åŒ–ï¼šè¿”å›Luaæ ‡å‡†è§„å®šçš„ç±»å‹å
- ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿å‚æ•°å­˜åœ¨ï¼Œé¿å…æ ˆè®¿é—®é”™è¯¯
*/
```

### ğŸ“¤ è¾“å‡ºè°ƒè¯•å‡½æ•°è¯¦è§£

#### ğŸ“¤ printå‡½æ•°çš„ç²¾å·§è®¾è®¡
```c
/* ğŸ“¤ æ‰“å°å‡½æ•°çš„å…¨é¢å®ç° */
static int luaB_print (lua_State *L) {
  /*
  printå‡½æ•°è®¾è®¡ç²¾é«“ï¼š
  
  1. ğŸ“Š å¤šå‚æ•°æ”¯æŒï¼šå¯ä»¥åŒæ—¶æ‰“å°ä»»æ„æ•°é‡çš„å€¼
  2. ğŸ”„ ç»Ÿä¸€æ ¼å¼åŒ–ï¼šé€šè¿‡tostringä¿è¯è¾“å‡ºä¸€è‡´æ€§
  3. ğŸ“‹ æ¸…æ™°åˆ†éš”ï¼šä½¿ç”¨åˆ¶è¡¨ç¬¦åˆ†éš”å¤šä¸ªå€¼
  4. ğŸš¨ é”™è¯¯å®‰å…¨ï¼šå¤„ç†tostringå¯èƒ½çš„å¤±è´¥æƒ…å†µ
  */
  
  int n = lua_gettop(L);                 // ğŸ“Š è·å–å‚æ•°æ•°é‡
  int i;
  lua_getglobal(L, "tostring");          // ğŸ”§ è·å–tostringå‡½æ•°
  
  for (i=1; i<=n; i++) {
    const char *s;
    lua_pushvalue(L, -1);                // ğŸ“‹ å¤åˆ¶tostringå‡½æ•°
    lua_pushvalue(L, i);                 // ğŸ¯ æ¨å…¥è¦æ‰“å°çš„å‚æ•°
    lua_call(L, 1, 1);                   // ğŸ”„ è°ƒç”¨tostringè½¬æ¢
    s = lua_tostring(L, -1);             // ğŸ“ è·å–å­—ç¬¦ä¸²ç»“æœ
    
    if (s == NULL)                       // ğŸš¨ tostringè¿”å›éå­—ç¬¦ä¸²ï¼Ÿ
      return luaL_error(L, LUA_QL("tostring") " must return a string to "
                           LUA_QL("print"));
    
    if (i>1) fputs("\t", stdout);        // ğŸ“‹ æ·»åŠ åˆ¶è¡¨ç¬¦åˆ†éš”
    fputs(s, stdout);                    // ğŸ“¤ è¾“å‡ºå­—ç¬¦ä¸²
    lua_pop(L, 1);                       // ğŸ§¹ æ¸…ç†æ ˆ
  }
  fputs("\n", stdout);                   // â†©ï¸ æ·»åŠ æ¢è¡Œç¬¦
  return 0;                              // ğŸ”š æ— è¿”å›å€¼
}

/*
ğŸ¨ è®¾è®¡ç²¾å¦™ä¹‹å¤„ï¼š
- ğŸ”„ ç»Ÿä¸€è½¬æ¢ï¼šæ‰€æœ‰å€¼éƒ½é€šè¿‡tostringè½¬æ¢ï¼Œç¡®ä¿è¾“å‡ºä¸€è‡´
- ğŸ“Š æ‰¹é‡å¤„ç†ï¼šä¸€æ¬¡è°ƒç”¨å¤„ç†å¤šä¸ªå‚æ•°ï¼Œæé«˜æ•ˆç‡
- ğŸ¯ æ ¼å¼æ§åˆ¶ï¼šåˆ¶è¡¨ç¬¦åˆ†éš” + æ¢è¡Œç»“æŸï¼Œè¾“å‡ºæ ¼å¼æ¸…æ™°
- ğŸš¨ å¥å£®æ€§ï¼šæ£€æŸ¥tostringè¿”å›å€¼ï¼Œé˜²æ­¢å¼‚å¸¸æƒ…å†µ
*/
```

### ğŸš¨ é”™è¯¯å¤„ç†æœºåˆ¶æ·±åº¦åˆ†æ

#### ğŸš¨ errorå‡½æ•°çš„å±‚æ¬¡åŒ–è®¾è®¡
```c
/* ğŸš¨ é”™è¯¯æŠ›å‡ºçš„æ™ºèƒ½å®ç° */
static int luaB_error (lua_State *L) {
  /*
  errorå‡½æ•°çš„å±‚æ¬¡åŒ–é”™è¯¯å¤„ç†ï¼š
  
  1. ğŸ“ ä½ç½®ä¿¡æ¯ï¼šè‡ªåŠ¨æ·»åŠ é”™è¯¯å‘ç”Ÿçš„ä½ç½®ä¿¡æ¯
  2. ğŸšï¸ çº§åˆ«æ§åˆ¶ï¼šé€šè¿‡levelå‚æ•°æ§åˆ¶é”™è¯¯æŠ¥å‘Šçº§åˆ«
  3. ğŸ“ æ¶ˆæ¯å¤„ç†ï¼šæ™ºèƒ½å¤„ç†é”™è¯¯æ¶ˆæ¯çš„æ ¼å¼åŒ–
  4. ğŸš¨ å¼‚å¸¸æŠ›å‡ºï¼šä½¿ç”¨VMçš„å¼‚å¸¸æœºåˆ¶æŠ›å‡ºé”™è¯¯
  */
  
  int level = luaL_optint(L, 2, 1);      // ğŸšï¸ è·å–é”™è¯¯çº§åˆ«ï¼Œé»˜è®¤ä¸º1
  lua_settop(L, 1);                      // ğŸ“Š åªä¿ç•™é”™è¯¯æ¶ˆæ¯
  
  if (lua_isstring(L, 1) && level > 0) { /* ğŸ“ éœ€è¦æ·»åŠ ä½ç½®ä¿¡æ¯ï¼Ÿ */
    luaL_where(L, level);                // ğŸ“ è·å–é”™è¯¯ä½ç½®ä¿¡æ¯
    lua_pushvalue(L, 1);                 // ğŸ“ æ¨å…¥é”™è¯¯æ¶ˆæ¯
    lua_concat(L, 2);                    // ğŸ”— è¿æ¥ä½ç½®å’Œæ¶ˆæ¯
  }
  return lua_error(L);                   // ğŸš¨ æŠ›å‡ºé”™è¯¯ï¼Œæ°¸ä¸è¿”å›
}

/*
ğŸ“ çº§åˆ«æ§åˆ¶çš„å·§å¦™è®¾è®¡ï¼š
- level = 1: é”™è¯¯æŒ‡å‘è°ƒç”¨errorçš„ä½ç½®ï¼ˆé»˜è®¤ï¼‰
- level = 2: é”™è¯¯æŒ‡å‘è°ƒç”¨è€…çš„è°ƒç”¨è€…
- level = 0: ä¸æ·»åŠ ä½ç½®ä¿¡æ¯
- level > æ ˆæ·±åº¦: æŒ‡å‘æ ˆåº•
*/
```

#### ğŸ›¡ï¸ assertå‡½æ•°çš„ç®€æ´å“²å­¦
```mermaid
graph LR
    subgraph "ğŸ›¡ï¸ assertå‡½æ•°æ‰§è¡Œæµç¨‹"
        A[ğŸ¯ è¾“å…¥æ¡ä»¶å’Œæ¶ˆæ¯] --> B{ğŸ” æ¡ä»¶åˆ¤æ–­}
        
        B -->|æ¡ä»¶ä¸ºçœŸ| C[âœ… è¿”å›æ‰€æœ‰å‚æ•°]
        B -->|æ¡ä»¶ä¸ºå‡| D[ğŸ“ æ„å»ºé”™è¯¯æ¶ˆæ¯]
        
        D --> E[ğŸš¨ æŠ›å‡ºé”™è¯¯]
        
        F[ğŸ’¡ è®¾è®¡æ™ºæ…§] --> G[ğŸ“Š é›¶å¼€é”€æˆåŠŸè·¯å¾„]
        F --> H[ğŸ”„ å‚æ•°é€ä¼ æœºåˆ¶]
        F --> I[ğŸ“ é»˜è®¤é”™è¯¯æ¶ˆæ¯]
    end
    
    style A fill:#e3f2fd
    style C fill:#c8e6c9
    style E fill:#ffcdd2
```

#### ğŸ”’ ä¿æŠ¤è°ƒç”¨æœºåˆ¶æ·±åº¦è§£æ

ä¿æŠ¤è°ƒç”¨æ˜¯Luaé”™è¯¯å¤„ç†çš„æ ¸å¿ƒæœºåˆ¶ï¼Œæä¾›äº†å®‰å…¨æ‰§è¡Œä»£ç çš„èƒ½åŠ›ï¼š

##### ğŸ›¡ï¸ pcallå‡½æ•°å®ç°è§£æ
```c
/* ğŸ”’ ä¿æŠ¤è°ƒç”¨çš„æ ¸å¿ƒå®ç° */
static int luaB_pcall (lua_State *L) {
  /*
  pcallçš„ä¿æŠ¤æœºåˆ¶è®¾è®¡ï¼š
  
  1. ğŸ›¡ï¸ å¼‚å¸¸æ•è·ï¼šæ•è·è¢«è°ƒç”¨å‡½æ•°å¯èƒ½æŠ›å‡ºçš„ä»»ä½•é”™è¯¯
  2. ğŸ“Š çŠ¶æ€è¿”å›ï¼šç¬¬ä¸€ä¸ªè¿”å›å€¼è¡¨ç¤ºæ‰§è¡Œæ˜¯å¦æˆåŠŸ
  3. ğŸ”„ ç»“æœé€ä¼ ï¼šæˆåŠŸæ—¶è¿”å›æ‰€æœ‰ç»“æœï¼Œå¤±è´¥æ—¶è¿”å›é”™è¯¯ä¿¡æ¯
  4. âš¡ æ€§èƒ½å‹å¥½ï¼šæ— é”™è¯¯æ—¶å‡ ä¹é›¶å¼€é”€
  */
  
  int status;
  luaL_checkany(L, 1);                   // ğŸ” ç¡®ä¿æœ‰è¢«è°ƒç”¨çš„å‡½æ•°
  status = lua_pcall(L, lua_gettop(L) - 1, LUA_MULTRET, 0);
  /*
  å‚æ•°è§£æï¼š
  - å‚æ•°æ•°é‡: lua_gettop(L) - 1 (å‡å»å‡½æ•°æœ¬èº«)  
  - è¿”å›å€¼æ•°é‡: LUA_MULTRET (ä¸é™åˆ¶è¿”å›å€¼æ•°é‡)
  - é”™è¯¯å¤„ç†å‡½æ•°: 0 (ä¸ä½¿ç”¨é”™è¯¯å¤„ç†å‡½æ•°)
  */
  
  lua_pushboolean(L, (status == 0));     // ğŸ“Š æ¨å…¥æˆåŠŸ/å¤±è´¥çŠ¶æ€
  lua_insert(L, 1);                      // ğŸ”„ å°†çŠ¶æ€æ’å…¥åˆ°ç»“æœæœ€å‰é¢
  return lua_gettop(L);                  // ğŸ“¤ è¿”å›çŠ¶æ€ + æ‰€æœ‰ç»“æœ/é”™è¯¯ä¿¡æ¯
}

/*
ğŸ¯ pcallè¿”å›å€¼åˆ†æï¼š
- æˆåŠŸæƒ…å†µ: true, result1, result2, ...
- å¤±è´¥æƒ…å†µ: false, error_message
*/
```

##### ğŸ”§ xpcallæ‰©å±•ä¿æŠ¤è°ƒç”¨
```c
/* ğŸ”§ å¸¦é”™è¯¯å¤„ç†å™¨çš„ä¿æŠ¤è°ƒç”¨ */
static int luaB_xpcall (lua_State *L) {
  /*
  xpcallçš„å¢å¼ºç‰¹æ€§ï¼š
  
  1. ğŸ¯ è‡ªå®šä¹‰é”™è¯¯å¤„ç†ï¼šå¯ä»¥æŒ‡å®šé”™è¯¯å¤„ç†å‡½æ•°
  2. ğŸ“Š é”™è¯¯ä¿¡æ¯å¢å¼ºï¼šé”™è¯¯å¤„ç†å‡½æ•°å¯ä»¥æ·»åŠ é¢å¤–ä¿¡æ¯
  3. ğŸ” è°ƒè¯•å‹å¥½ï¼šæ”¯æŒè·å–è°ƒç”¨æ ˆç­‰è°ƒè¯•ä¿¡æ¯
  4. ğŸ›¡ï¸ åŒé‡ä¿æŠ¤ï¼šé”™è¯¯å¤„ç†å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¿æŠ¤æ‰§è¡Œçš„
  */
  
  int status;
  luaL_checkany(L, 2);                   // ğŸ” éœ€è¦å‡½æ•°å’Œé”™è¯¯å¤„ç†å™¨
  lua_settop(L, 2);                      // ğŸ“Š åªä¿ç•™å‡½æ•°å’Œé”™è¯¯å¤„ç†å™¨
  lua_insert(L, 1);                      // ğŸ”„ å°†é”™è¯¯å¤„ç†å™¨æ”¾åœ¨å‡½æ•°ä¸‹é¢
  
  /* 
  æ ˆå¸ƒå±€å˜åŒ–ï¼š
  åŸå§‹: [func, error_handler]  
  è°ƒæ•´å: [error_handler, func]
  */
  
  status = lua_pcall(L, 0, LUA_MULTRET, 1);  // ğŸ›¡ï¸ ä½¿ç”¨ç´¢å¼•1çš„é”™è¯¯å¤„ç†å™¨
  lua_pushboolean(L, (status == 0));     // ğŸ“Š æ¨å…¥æ‰§è¡ŒçŠ¶æ€
  lua_replace(L, 1);                      // ğŸ”„ æ›¿æ¢é”™è¯¯å¤„ç†å™¨ä½ç½®
  return lua_gettop(L);                   // ğŸ“¤ è¿”å›æ‰€æœ‰ç»“æœ
}

/*
ğŸ’¡ xpcall vs pcallå¯¹æ¯”ï¼š
- pcall: ç®€å•ä¿æŠ¤ï¼Œç›´æ¥è¿”å›é”™è¯¯æ¶ˆæ¯
- xpcall: é«˜çº§ä¿æŠ¤ï¼Œå¯è‡ªå®šä¹‰é”™è¯¯æ¶ˆæ¯æ ¼å¼å’Œå†…å®¹
- ä½¿ç”¨åœºæ™¯: xpcallé€‚åˆéœ€è¦è¯¦ç»†è°ƒè¯•ä¿¡æ¯çš„åœºåˆ
*/
```

#### ğŸ“Š é”™è¯¯å¤„ç†æœºåˆ¶å¯¹æ¯”åˆ†æ

| å‡½æ•° | é”™è¯¯æ£€æµ‹ | é”™è¯¯å“åº” | è¿”å›å€¼ | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|--------|----------|
| `error` | âŒ ç›´æ¥æŠ›å‡º | ğŸš¨ ä¸­æ–­æ‰§è¡Œ | æ°¸ä¸è¿”å› | ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ |
| `assert` | âœ… æ¡ä»¶æ£€æŸ¥ | ğŸš¨ æ¡ä»¶å¤±è´¥æ—¶ä¸­æ–­ | é€ä¼ å‚æ•° | å‰ç½®æ¡ä»¶éªŒè¯ |
| `pcall` | âœ… å¼‚å¸¸æ•è· | ğŸ›¡ï¸ è¿”å›çŠ¶æ€æ ‡è¯† | çŠ¶æ€+ç»“æœ | å®‰å…¨å‡½æ•°è°ƒç”¨ |
| `xpcall` | âœ… å¼‚å¸¸æ•è· | ğŸ”§ è‡ªå®šä¹‰å¤„ç† | çŠ¶æ€+å¤„ç†ç»“æœ | é«˜çº§é”™è¯¯å¤„ç† |

#### ğŸ¯ é”™è¯¯å¤„ç†æœ€ä½³å®è·µ
```lua
-- ğŸ›¡ï¸ ç®€å•ä¿æŠ¤è°ƒç”¨
local success, result = pcall(risky_function, arg1, arg2)
if success then
    print("Success:", result)
else
    print("Error:", result)  -- resultæ˜¯é”™è¯¯æ¶ˆæ¯
end

-- ğŸ”§ é«˜çº§é”™è¯¯å¤„ç†
local function error_handler(err)
    return debug.traceback("Error occurred: " .. tostring(err), 2)
end

local success, result = xpcall(risky_function, error_handler, arg1, arg2)
if not success then
    print(result)  -- åŒ…å«å®Œæ•´è°ƒç”¨æ ˆçš„é”™è¯¯ä¿¡æ¯
end

-- ğŸ¯ æ–­è¨€éªŒè¯
local function divide(a, b)
    assert(b ~= 0, "Division by zero")  -- å‰ç½®æ¡ä»¶æ£€æŸ¥
    return a / b
end
```

### âš¡ å‡½æ•°æ€§èƒ½ç‰¹å¾åˆ†æ

#### ğŸ“Š æ ¸å¿ƒå‡½æ•°æ€§èƒ½å¯¹æ¯”
```mermaid
graph TB
    subgraph "âš¡ åŸºç¡€åº“å‡½æ•°æ€§èƒ½ç‰¹å¾"
        A[ğŸš€ é«˜æ€§èƒ½å‡½æ•°] --> A1[type - O&lpar;1&rpar;]
        A --> A2[tonumber - O&lpar;1&rpar; å¿«é€Ÿè·¯å¾„]
        A --> A3[rawget - O&lpar;1&rpar;]
        
        B[âš–ï¸ ä¸­ç­‰æ€§èƒ½å‡½æ•°] --> B1[tostring - ä¾èµ–å…ƒæ–¹æ³•]
        B --> B2[print - ä¾èµ–tostring]
        B --> B3[next - è¡¨éå† O&lpar;n&rpar;]
        
        C[ğŸ”„ æ§åˆ¶å‡½æ•°] --> C1[pcall - å¼‚å¸¸å¤„ç†å¼€é”€]
        C --> C2[error - æ ˆå±•å¼€å¼€é”€]
        C --> C3[collectgarbage - GCæ“ä½œ]
    end
    
    style A fill:#c8e6c9
    style B fill:#fff3e0
    style C fill:#ffcdd2
```

### ğŸ” è¿­ä»£å™¨å‡½æ•°æ·±åº¦å®ç°

#### ğŸ” nextå‡½æ•°çš„æ ¸å¿ƒæœºåˆ¶
```c
/* ğŸ” è¡¨éå†çš„åŸºç¡€å®ç° */
static int luaB_next (lua_State *L) {
  /*
  nextå‡½æ•°çš„éå†æœºåˆ¶ï¼š
  
  1. ğŸ¯ è¡¨éå†åŸºç¡€ï¼šæä¾›è¡¨çš„é”®å€¼å¯¹éå†åŠŸèƒ½
  2. ğŸ“Š çŠ¶æ€ç»´æŠ¤ï¼šé€šè¿‡é”®æ¥ç»´æŠ¤éå†çŠ¶æ€  
  3. ğŸ”š ç»“æŸæ£€æµ‹ï¼šè¿”å›nilè¡¨ç¤ºéå†ç»“æŸ
  4. âš¡ é«˜æ•ˆå®ç°ï¼šç›´æ¥è°ƒç”¨VMå†…éƒ¨éå†å‡½æ•°
  */
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ” ç¡®ä¿ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨
  lua_settop(L, 2);                      // ğŸ“Š åˆ›å»ºç¬¬äºŒä¸ªå‚æ•°ä½ç½®(å¦‚æœä¸å­˜åœ¨)
  
  if (lua_next(L, 1))                    // ğŸ”„ VMå†…éƒ¨nextå®ç°
    return 2;                            // ğŸ“¤ è¿”å›é”®å€¼å¯¹
  else {
    lua_pushnil(L);                      // ğŸ”š éå†ç»“æŸï¼Œè¿”å›nil
    return 1;
  }
}

/*
ğŸ§  nextå‡½æ•°å·¥ä½œåŸç†ï¼š
1. ç¬¬ä¸€æ¬¡è°ƒç”¨: next(table, nil) -> è¿”å›ç¬¬ä¸€ä¸ªé”®å€¼å¯¹
2. åç»­è°ƒç”¨: next(table, key) -> è¿”å›ä¸‹ä¸€ä¸ªé”®å€¼å¯¹  
3. ç»“æŸæ ‡å¿—: next(table, last_key) -> è¿”å›nil
*/
```

#### ğŸ”„ pairså‡½æ•°çš„é—­åŒ…è®¾è®¡
```mermaid
graph TB
    subgraph "ğŸ”„ pairså‡½æ•°å®ç°æœºåˆ¶"
        A[ğŸ¯ pairs&lpar;table&rpar;è°ƒç”¨] --> B[ğŸ“‹ å‡†å¤‡è¿­ä»£å™¨ç»„ä»¶]
        
        B --> C[ğŸ”§ nextå‡½æ•°]
        B --> D[ğŸ“Š ç›®æ ‡è¡¨]  
        B --> E[ğŸ”‘ èµ·å§‹é”®&lpar;nil&rpar;]
        
        C --> F[ğŸ“¤ è¿”å›ä¸‰å…ƒç»„]
        D --> F
        E --> F
        
        F --> G[ğŸ”„ forå¾ªç¯ä½¿ç”¨]
        
        H[ğŸ’¡ è®¾è®¡å·§æ€] --> I[ğŸ“‹ æ ‡å‡†è¿­ä»£å™¨åè®®]
        H --> J[âš¡ é›¶å¼€é”€æŠ½è±¡]
        H --> K[ğŸ¯ é€šç”¨éå†æ¥å£]
    end
    
    style A fill:#e3f2fd
    style F fill:#c8e6c9
    style G fill:#fff3e0
```

```c
/* ğŸ”„ é”®å€¼å¯¹è¿­ä»£å™¨çš„å®ç° */  
static int luaB_pairs (lua_State *L) {
  /*
  pairså‡½æ•°çš„å·§å¦™è®¾è®¡ï¼š
  
  1. ğŸ”§ è¿­ä»£å™¨å‡½æ•°ï¼šè¿”å›nextå‡½æ•°ä½œä¸ºè¿­ä»£å™¨
  2. ğŸ“Š çŠ¶æ€å¯¹è±¡ï¼šè¿”å›è¡¨æœ¬èº«ä½œä¸ºçŠ¶æ€
  3. ğŸ”‘ åˆå§‹å€¼ï¼šè¿”å›nilä½œä¸ºèµ·å§‹é”®
  4. ğŸ“‹ æ ‡å‡†åè®®ï¼šç¬¦åˆLua forå¾ªç¯çš„è¿­ä»£å™¨åè®®
  */
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ” ç¡®ä¿å‚æ•°æ˜¯è¡¨
  lua_pushvalue(L, lua_upvalueindex(1)); // ğŸ”§ æ¨å…¥nextå‡½æ•°(upvalue)
  lua_pushvalue(L, 1);                   // ğŸ“Š æ¨å…¥è¡¨
  lua_pushnil(L);                        // ğŸ”‘ æ¨å…¥èµ·å§‹é”®(nil)
  return 3;                              // ğŸ“¤ è¿”å›è¿­ä»£å™¨ä¸‰å…ƒç»„
}

/*
ğŸ¯ è¿­ä»£å™¨åè®®è¯´æ˜ï¼š
for key, value in pairs(table) do
    -- Luaå†…éƒ¨å±•å¼€ä¸ºï¼š
    -- local iter, state, initial = pairs(table)
    -- local key, value = initial, nil
    -- while true do
    --     key, value = iter(state, key)
    --     if key == nil then break end
    --     -- å¾ªç¯ä½“
    -- end
end
*/
```

#### ğŸ“‹ ipairsæ•°ç»„è¿­ä»£å™¨
```c
/* ğŸ“Š æ•°ç»„ç´¢å¼•è¿­ä»£å™¨çš„å®ç° */
static int ipairsaux (lua_State *L) {
  /*
  ipairsè¾…åŠ©å‡½æ•°è®¾è®¡ï¼š
  
  1. ğŸ“ˆ ç´¢å¼•é€’å¢ï¼šæ¯æ¬¡è°ƒç”¨ç´¢å¼•åŠ 1
  2. ğŸ” è¾¹ç•Œæ£€æŸ¥ï¼šæ£€æŸ¥æ•°ç»„é•¿åº¦è¾¹ç•Œ
  3. ğŸ“Š æ•´æ•°ç´¢å¼•ï¼šåªå¤„ç†æ­£æ•´æ•°ç´¢å¼•
  4. âš¡ é«˜æ•ˆè®¿é—®ï¼šç›´æ¥æ•°ç»„ç´¢å¼•è®¿é—®
  */
  
  int i = luaL_checkint(L, 2);           // ğŸ”¢ è·å–å½“å‰ç´¢å¼•
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ” ç¡®ä¿æ˜¯è¡¨
  i++;                                   // ğŸ“ˆ ç´¢å¼•é€’å¢
  lua_pushinteger(L, i);                 // ğŸ“Š æ¨å…¥æ–°ç´¢å¼•
  lua_rawgeti(L, 1, i);                  // ğŸ” è·å–å¯¹åº”å€¼
  return (lua_isnil(L, -1)) ? 0 : 2;     // ğŸ“¤ å€¼ä¸ºnilåˆ™ç»“æŸï¼Œå¦åˆ™è¿”å›ç´¢å¼•å€¼å¯¹
}

static int luaB_ipairs (lua_State *L) {
  /*
  ipairsä¸»å‡½æ•°ï¼š
  - è¿”å›ipairsauxä½œä¸ºè¿­ä»£å™¨å‡½æ•°
  - è¿”å›è¡¨ä½œä¸ºçŠ¶æ€
  - è¿”å›0ä½œä¸ºèµ·å§‹ç´¢å¼•
  */
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ” ç¡®ä¿å‚æ•°æ˜¯è¡¨
  lua_pushvalue(L, lua_upvalueindex(1)); // ğŸ”§ æ¨å…¥ipairsauxå‡½æ•°
  lua_pushvalue(L, 1);                   // ğŸ“Š æ¨å…¥è¡¨
  lua_pushinteger(L, 0);                 // ğŸ”¢ æ¨å…¥èµ·å§‹ç´¢å¼•
  return 3;                              // ğŸ“¤ è¿”å›è¿­ä»£å™¨ä¸‰å…ƒç»„
}
```

### ğŸ“‹ å®ç”¨å·¥å…·å‡½æ•°è¯¦è§£

#### ğŸ“‹ selectå‡½æ•°çš„å¤šæ€è®¾è®¡
```c
/* ğŸ“‹ å‚æ•°é€‰æ‹©å‡½æ•°çš„å®ç° */
static int luaB_select (lua_State *L) {
  /*
  selectå‡½æ•°çš„å¤šåŠŸèƒ½è®¾è®¡ï¼š
  
  1. ğŸ“Š å‚æ•°è®¡æ•°ï¼šselect('#', ...) è¿”å›å‚æ•°æ•°é‡
  2. ğŸ“‹ å‚æ•°é€‰æ‹©ï¼šselect(n, ...) è¿”å›ç¬¬nä¸ªåŠä¹‹åçš„å‚æ•°
  3. ğŸ”¢ è´Ÿæ•°ç´¢å¼•ï¼šæ”¯æŒä»æœ«å°¾å¼€å§‹çš„ç´¢å¼•
  4. âš¡ é›¶æ‹·è´ï¼šä¸å¤åˆ¶å‚æ•°ï¼Œç›´æ¥è°ƒæ•´æ ˆæŒ‡é’ˆ
  */
  
  int n = lua_gettop(L);                 // ğŸ“Š è·å–æ€»å‚æ•°æ•°é‡
  
  if (lua_type(L, 1) == LUA_TSTRING && *lua_tostring(L, 1) == '#') {
    /* ğŸ“Š å‚æ•°è®¡æ•°æ¨¡å¼ */
    lua_pushinteger(L, n-1);             // ğŸ“‹ è¿”å›å‚æ•°æ•°é‡(ä¸åŒ…æ‹¬'#')
    return 1;
  }
  else {
    /* ğŸ“‹ å‚æ•°é€‰æ‹©æ¨¡å¼ */
    int i = luaL_checkint(L, 1);         // ğŸ”¢ è·å–èµ·å§‹ç´¢å¼•
    if (i < 0) i = n + i;                // ğŸ”„ å¤„ç†è´Ÿæ•°ç´¢å¼•
    else if (i > n) i = n;               // ğŸ” å¤„ç†è¶…ç•Œç´¢å¼•
    luaL_argcheck(L, 1 <= i, 1, "index out of range");
    return n - i;                        // ğŸ“¤ è¿”å›ä»iå¼€å§‹çš„å‚æ•°æ•°é‡
  }
}

/*
ğŸ’¡ selectå‡½æ•°åº”ç”¨åœºæ™¯ï¼š
- å¤„ç†å¯å˜å‚æ•°å‡½æ•°ä¸­çš„å‚æ•°
- è·å–å‚æ•°æ•°é‡è€Œæ— éœ€table.pack
- ä»å‚æ•°åˆ—è¡¨ä¸­æå–å­é›†
*/
```

#### ğŸ“¦ unpackå‡½æ•°çš„å±•å¼€æœºåˆ¶
```c
/* ğŸ“¦ æ•°ç»„å±•å¼€å‡½æ•°çš„å®ç° */
static int luaB_unpack (lua_State *L) {
  /*
  unpackå‡½æ•°çš„å±•å¼€ç­–ç•¥ï¼š
  
  1. ğŸ“Š èŒƒå›´æ§åˆ¶ï¼šæ”¯æŒæŒ‡å®šèµ·å§‹å’Œç»“æŸç´¢å¼•
  2. ğŸ“‹ é»˜è®¤èŒƒå›´ï¼šé»˜è®¤å±•å¼€æ•´ä¸ªæ•°ç»„éƒ¨åˆ†
  3. âš¡ æ‰¹é‡æ¨å…¥ï¼šé«˜æ•ˆåœ°å°†æ•°ç»„å…ƒç´ æ¨å…¥æ ˆ
  4. ğŸ” è¾¹ç•Œå®‰å…¨ï¼šå¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
  */
  
  int i, e, n;
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ” ç¡®ä¿ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨
  i = luaL_optint(L, 2, 1);              // ğŸ“Š è·å–èµ·å§‹ç´¢å¼•ï¼Œé»˜è®¤ä¸º1
  e = luaL_opt(L, luaL_checkint, 3, luaL_getn(L, 1)); // ğŸ“‹ è·å–ç»“æŸç´¢å¼•
  
  if (i > e) return 0;                   // ğŸ” èŒƒå›´æ£€æŸ¥ï¼šèµ·å§‹ç´¢å¼•å¤§äºç»“æŸç´¢å¼•
  n = e - i + 1;                         // ğŸ“Š è®¡ç®—å…ƒç´ æ•°é‡
  
  if (n <= 0 || !lua_checkstack(L, n))  // ğŸ” æ ˆç©ºé—´æ£€æŸ¥
    return luaL_error(L, "too many results to unpack");
    
  for (; i<=e; i++) {                    // ğŸ”„ æ‰¹é‡å±•å¼€å…ƒç´ 
    lua_rawgeti(L, 1, i);                // ğŸ“‹ æ¨å…¥è¡¨ä¸­ç´¢å¼•içš„å€¼
  }
  return n;                              // ğŸ“¤ è¿”å›å±•å¼€çš„å…ƒç´ æ•°é‡
}

/*
ğŸ¯ unpackä½¿ç”¨ç¤ºä¾‹ï¼š
local t = {10, 20, 30, 40, 50}
print(unpack(t))        -- è¾“å‡º: 10 20 30 40 50  
print(unpack(t, 2, 4))  -- è¾“å‡º: 20 30 40
*/
```

### ğŸ­ é«˜çº§å‡½æ•°ç‰¹æ€§åˆ†æ

#### ğŸ“Š å‡½æ•°å¤æ‚åº¦å¯¹æ¯”
```mermaid
graph TB
    subgraph "ğŸ“Š åŸºç¡€åº“å‡½æ•°å¤æ‚åº¦åˆ†æ"
        A[ğŸŸ¢ O&lpar;1&rpar; å¸¸æ•°æ—¶é—´] --> A1[type - ç±»å‹æ£€æŸ¥]
        A --> A2[rawget - ç›´æ¥è®¿é—®]
        A --> A3[rawset - ç›´æ¥è®¾ç½®]
        
        B[ğŸŸ¡ O&lpar;k&rpar; å‚æ•°ç›¸å…³] --> B1[print - å‚æ•°æ•°é‡]
        B --> B2[select - å‚æ•°æ•°é‡]
        B --> B3[unpack - å±•å¼€èŒƒå›´]
        
        C[ğŸŸ  O&lpar;n&rpar; è¡¨å¤§å°ç›¸å…³] --> C1[next - è¡¨éå†]
        C --> C2[pairs - è¿­ä»£å™¨åˆ›å»º]
        C --> C3[collectgarbage - GCæ“ä½œ]
        
        D[ğŸ”´ ä¸å®šæ—¶é—´] --> D1[pcall - è¢«è°ƒå‡½æ•°å†³å®š]
        D --> D2[xpcall - é”™è¯¯å¤„ç†å¼€é”€]
        D --> D3[tonumber - å­—ç¬¦ä¸²è§£æ]
    end
    
    style A fill:#c8e6c9
    style B fill:#fff3e0
    style C fill:#ffecb3
    style D fill:#ffcdd2
```

## ğŸ­ å…ƒç¼–ç¨‹æœºåˆ¶æ·±åº¦è§£æ

### ğŸ¯ å…ƒè¡¨æ“ä½œæ ¸å¿ƒæœºåˆ¶

å…ƒè¡¨(Metatable)æ˜¯Luaå…ƒç¼–ç¨‹çš„æ ¸å¿ƒï¼Œå®ƒå…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶ä¿®æ”¹å¯¹è±¡çš„è¡Œä¸ºï¼š

#### ğŸ“‹ getmetatableå‡½æ•°çš„å®‰å…¨è®¾è®¡
```mermaid
graph TB
    subgraph "ğŸ“‹ getmetatableå®‰å…¨æœºåˆ¶"
        A[ğŸ¯ getmetatable&lpar;obj&rpar;] --> B{ğŸ” å¯¹è±¡æœ‰å…ƒè¡¨ï¼Ÿ}
        
        B -->|æ— å…ƒè¡¨| C[ğŸ“¤ è¿”å›nil]
        B -->|æœ‰å…ƒè¡¨| D{ğŸ”’ æ£€æŸ¥__metatableå­—æ®µ}
        
        D -->|å­˜åœ¨__metatable| E[ğŸ“‹ è¿”å›__metatableå€¼]
        D -->|ä¸å­˜åœ¨__metatable| F[ğŸ“Š è¿”å›çœŸå®å…ƒè¡¨]
        
        G[ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶] --> H[ğŸ”’ å…ƒè¡¨ä¿æŠ¤]
        G --> I[ğŸ“‹ è®¿é—®æ§åˆ¶]
        G --> J[ğŸ¯ ä¸€è‡´æ€§ä¿è¯]
    end
    
    style A fill:#e3f2fd
    style C fill:#ffcdd2
    style E fill:#c8e6c9
    style F fill:#c8e6c9
```

```c
/* ğŸ“‹ è·å–å…ƒè¡¨çš„å®‰å…¨å®ç° */
static int luaB_getmetatable (lua_State *L) {
  /*
  getmetatableçš„å®‰å…¨è®¾è®¡ï¼š
  
  1. ğŸ” é€šç”¨æ£€æŸ¥ï¼šæ”¯æŒæ‰€æœ‰ç±»å‹çš„å¯¹è±¡
  2. ğŸ”’ ä¿æŠ¤æœºåˆ¶ï¼šé€šè¿‡__metatableå­—æ®µæ§åˆ¶è®¿é—®
  3. ğŸ“‹ ç»Ÿä¸€æ¥å£ï¼šä¸ºä¸åŒç±»å‹æä¾›ä¸€è‡´çš„å…ƒè¡¨è®¿é—®
  4. ğŸ›¡ï¸ å®‰å…¨è¿”å›ï¼šç¡®ä¿è¿”å›å€¼çš„å®‰å…¨æ€§
  */
  
  luaL_checkany(L, 1);                   // ğŸ” ç¡®ä¿è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°
  
  if (!lua_getmetatable(L, 1)) {         // ğŸ” å°è¯•è·å–å…ƒè¡¨
    lua_pushnil(L);                      // ğŸ“‹ æ— å…ƒè¡¨æ—¶è¿”å›nil
    return 1;
  }
  
  luaL_getmetafield(L, 1, "__metatable"); // ğŸ”’ æ£€æŸ¥ä¿æŠ¤å­—æ®µ
  return 1;  /* ğŸ“¤ è¿”å›__metatableå­—æ®µå€¼æˆ–å…ƒè¡¨æœ¬èº« */
}

/*
ğŸ”’ å…ƒè¡¨ä¿æŠ¤æœºåˆ¶è¯´æ˜ï¼š
- __metatableå­—æ®µå­˜åœ¨: è¿”å›__metatableçš„å€¼ï¼Œéšè—çœŸå®å…ƒè¡¨
- __metatableå­—æ®µä¸å­˜åœ¨: è¿”å›çœŸå®å…ƒè¡¨
- è¿™ç§è®¾è®¡å…è®¸åº“ä½œè€…ä¿æŠ¤å…ƒè¡¨ä¸è¢«æ„å¤–ä¿®æ”¹
*/
```

#### ğŸ“ setmetatableå‡½æ•°çš„ä¿æŠ¤æœºåˆ¶
```c
/* ğŸ“ è®¾ç½®å…ƒè¡¨çš„å®‰å…¨å®ç° */
static int luaB_setmetatable (lua_State *L) {
  /*
  setmetatableçš„ä¿æŠ¤ç­–ç•¥ï¼š
  
  1. ğŸ¯ ç±»å‹é™åˆ¶ï¼šåªèƒ½ä¸ºè¡¨è®¾ç½®å…ƒè¡¨
  2. ğŸ”’ ä¿æŠ¤æ£€æŸ¥ï¼šæ£€æŸ¥ç°æœ‰å…ƒè¡¨çš„ä¿æŠ¤çŠ¶æ€
  3. ğŸ“‹ å‚æ•°éªŒè¯ï¼šç¡®ä¿å…ƒè¡¨å‚æ•°çš„æœ‰æ•ˆæ€§
  4. ğŸ”„ æ“ä½œåŸå­ï¼šè®¾ç½®æ“ä½œè¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥
  */
  
  int t = lua_type(L, 2);                // ğŸ” è·å–ç¬¬äºŒä¸ªå‚æ•°ç±»å‹
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ¯ ç¡®ä¿ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨
  luaL_argcheck(L, t == LUA_TNIL || t == LUA_TTABLE, 2,
                    "nil or table expected");  // ğŸ“‹ éªŒè¯å…ƒè¡¨å‚æ•°
  
  if (luaL_getmetafield(L, 1, "__metatable")) // ğŸ”’ æ£€æŸ¥ä¿æŠ¤å­—æ®µ
    luaL_error(L, "cannot change a protected metatable");
  
  lua_settop(L, 2);                      // ğŸ“Š åªä¿ç•™è¡¨å’Œå…ƒè¡¨å‚æ•°
  lua_setmetatable(L, 1);                // ğŸ“ è®¾ç½®å…ƒè¡¨
  return 1;                              // ğŸ“¤ è¿”å›è¡¨æœ¬èº«
}

/*
ğŸ›¡ï¸ ä¿æŠ¤æœºåˆ¶è¦ç‚¹ï¼š
- åªæœ‰è¡¨å¯ä»¥è®¾ç½®å…ƒè¡¨ï¼ˆåœ¨åŸºç¡€åº“ä¸­ï¼‰
- æ£€æŸ¥__metatableä¿æŠ¤å­—æ®µï¼Œé˜²æ­¢ä¿®æ”¹å—ä¿æŠ¤çš„å…ƒè¡¨
- å‚æ•°ç±»å‹ä¸¥æ ¼éªŒè¯ï¼šå…ƒè¡¨å¿…é¡»æ˜¯tableæˆ–nil
- è¿”å›è¡¨æœ¬èº«ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨
*/
```

### ğŸ”„ åŸå§‹æ“ä½œå‡½æ•°è¯¦è§£

åŸå§‹æ“ä½œ(Raw Operations)ç»•è¿‡å…ƒæ–¹æ³•ç›´æ¥æ“ä½œå¯¹è±¡ï¼Œæ˜¯å…ƒç¼–ç¨‹çš„é‡è¦å·¥å…·ï¼š

#### ğŸ”„ rawget/rawsetå®ç°åŸç†
```c
/* ğŸ”„ åŸå§‹è·å–æ“ä½œ */
static int luaB_rawget (lua_State *L) {
  /*
  rawgetçš„ç›´æ¥è®¿é—®æœºåˆ¶ï¼š
  
  1. ğŸ¯ ç»•è¿‡å…ƒæ–¹æ³•ï¼šç›´æ¥è®¿é—®è¡¨ï¼Œä¸è§¦å‘__index
  2. ğŸ“Š ç±»å‹æ£€æŸ¥ï¼šç¡®ä¿æ“ä½œå¯¹è±¡æ˜¯è¡¨
  3. âš¡ é«˜æ•ˆè®¿é—®ï¼šç›´æ¥è°ƒç”¨VMå†…éƒ¨å‡½æ•°
  4. ğŸ” å®Œæ•´æ€§ï¼šæ”¯æŒä»»æ„ç±»å‹çš„é”®
  */
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ¯ ç¡®ä¿ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨
  luaL_checkany(L, 2);                   // ğŸ” ç¡®ä¿æœ‰é”®å‚æ•°
  lua_settop(L, 2);                      // ğŸ“Š åªä¿ç•™è¡¨å’Œé”®
  lua_rawget(L, 1);                      // ğŸ”„ åŸå§‹è·å–æ“ä½œ
  return 1;                              // ğŸ“¤ è¿”å›è·å–çš„å€¼
}

/* ğŸ”„ åŸå§‹è®¾ç½®æ“ä½œ */
static int luaB_rawset (lua_State *L) {
  /*
  rawsetçš„ç›´æ¥è®¾ç½®æœºåˆ¶ï¼š
  - ç»•è¿‡__newindexå…ƒæ–¹æ³•
  - ç›´æ¥åœ¨è¡¨ä¸­è®¾ç½®é”®å€¼å¯¹
  - æ”¯æŒä»»æ„ç±»å‹çš„é”®å’Œå€¼
  */
  
  luaL_checktype(L, 1, LUA_TTABLE);      // ğŸ¯ ç¡®ä¿ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨
  luaL_checkany(L, 2);                   // ğŸ” ç¡®ä¿æœ‰é”®å‚æ•°
  luaL_checkany(L, 3);                   // ğŸ” ç¡®ä¿æœ‰å€¼å‚æ•°
  lua_settop(L, 3);                      // ğŸ“Š åªä¿ç•™è¡¨ã€é”®å’Œå€¼
  lua_rawset(L, 1);                      // ğŸ”„ åŸå§‹è®¾ç½®æ“ä½œ
  return 1;                              // ğŸ“¤ è¿”å›è¡¨æœ¬èº«
}

/* ğŸ”„ åŸå§‹ç›¸ç­‰æ¯”è¾ƒ */
static int luaB_rawequal (lua_State *L) {
  /*
  rawequalçš„ç›´æ¥æ¯”è¾ƒï¼š
  - ç»•è¿‡__eqå…ƒæ–¹æ³•
  - ä½¿ç”¨VMå†…éƒ¨çš„ç›¸ç­‰æ¯”è¾ƒ
  - æ¯”è¾ƒå¯¹è±¡çš„åŸå§‹å€¼å’Œå¼•ç”¨
  */
  
  luaL_checkany(L, 1);                   // ğŸ” ç¡®ä¿æœ‰ç¬¬ä¸€ä¸ªå‚æ•°
  luaL_checkany(L, 2);                   // ğŸ” ç¡®ä¿æœ‰ç¬¬äºŒä¸ªå‚æ•°
  lua_pushboolean(L, lua_rawequal(L, 1, 2)); // ğŸ”„ åŸå§‹ç›¸ç­‰æ¯”è¾ƒ
  return 1;                              // ğŸ“¤ è¿”å›å¸ƒå°”ç»“æœ
}
```

#### ğŸ¯ åŸå§‹æ“ä½œåº”ç”¨åœºæ™¯
```lua
-- ğŸ­ å…ƒè¡¨æ“ä½œç¤ºä¾‹
local proxy = {}
local data = {x = 10, y = 20}

setmetatable(proxy, {
  __index = function(t, k)
    print("Accessing:", k)
    return rawget(data, k)  -- ğŸ”„ ç»•è¿‡é€’å½’è°ƒç”¨
  end,
  
  __newindex = function(t, k, v)
    print("Setting:", k, "=", v)
    rawset(data, k, v)      -- ğŸ”„ ç›´æ¥è®¾ç½®ï¼Œé¿å…æ— é™é€’å½’
  end
})

print(proxy.x)        -- è§¦å‘__indexï¼Œè¾“å‡º"Accessing: x"ï¼Œç„¶åè¾“å‡º10
proxy.z = 30          -- è§¦å‘__newindexï¼Œè®¾ç½®data.z = 30
```

### ğŸŒ ç¯å¢ƒç®¡ç†æœºåˆ¶æ·±åº¦è§£æ

ç¯å¢ƒ(Environment)æ§åˆ¶å‡½æ•°çš„å…¨å±€å˜é‡è®¿é—®ï¼Œæ˜¯Luaæ²™ç®±å’Œæ¨¡å—ç³»ç»Ÿçš„åŸºç¡€ï¼š

#### ğŸŒ getfenvå‡½æ•°çš„ç¯å¢ƒè·å–
```c
/* ğŸŒ è·å–å‡½æ•°ç¯å¢ƒ */
static int luaB_getfenv (lua_State *L) {
  /*
  getfenvçš„ç¯å¢ƒè®¿é—®æœºåˆ¶ï¼š
  
  1. ğŸ¯ å‡½æ•°å®šä½ï¼šæ”¯æŒå¤šç§å‡½æ•°æŒ‡å®šæ–¹å¼
  2. ğŸ” ç±»å‹åŒºåˆ†ï¼šCå‡½æ•°å’ŒLuaå‡½æ•°çš„ä¸åŒå¤„ç†
  3. ğŸŒ ç¯å¢ƒè¿”å›ï¼šè¿”å›å‡½æ•°çš„æ‰§è¡Œç¯å¢ƒ
  4. ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿æ“ä½œçš„åˆæ³•æ€§
  */
  
  getfunc(L);                            // ğŸ” è·å–å‡½æ•°å¯¹è±¡
  
  if (lua_iscfunction(L, -1))            // ğŸ” æ˜¯Cå‡½æ•°ï¼Ÿ
    lua_pushvalue(L, LUA_GLOBALSINDEX);  // ğŸŒ è¿”å›å…¨å±€ç¯å¢ƒ
  else
    lua_getfenv(L, -1);                  // ğŸ¯ è·å–Luaå‡½æ•°çš„ç¯å¢ƒ
    
  return 1;                              // ğŸ“¤ è¿”å›ç¯å¢ƒè¡¨
}

/* ğŸ” è¾…åŠ©å‡½æ•°ï¼šè·å–å‡½æ•°å¯¹è±¡ */
static void getfunc (lua_State *L) {
  /*
  å‡½æ•°å®šä½ç­–ç•¥ï¼š
  1. æ— å‚æ•°æˆ–nil: è·å–è°ƒç”¨è€…å‡½æ•°
  2. æ•°å­—: è·å–æŒ‡å®šæ ˆçº§åˆ«çš„å‡½æ•°  
  3. å‡½æ•°å¯¹è±¡: ç›´æ¥ä½¿ç”¨è¯¥å‡½æ•°
  */
  
  if (lua_isnoneornil(L, 1))             // ğŸ” æ— å‚æ•°ï¼Ÿ
    lua_pushvalue(L, lua_upvalueindex(1)); // ğŸ¯ è·å–è°ƒç”¨è€…
  else if (lua_isnumber(L, 1)) {         // ğŸ”¢ æ•°å­—å‚æ•°ï¼Ÿ
    lua_Debug ar;
    int level = (int)lua_tointeger(L, 1);
    luaL_argcheck(L, level >= 0, 1, "level must be non-negative");
    if (lua_getstack(L, level, &ar) == 0)
      luaL_argerror(L, 1, "invalid level");
    lua_getinfo(L, "f", &ar);            // ğŸ“Š è·å–æŒ‡å®šçº§åˆ«çš„å‡½æ•°
  }
  else {                                 // ğŸ”§ å‡½æ•°å¯¹è±¡
    luaL_checktype(L, 1, LUA_TFUNCTION);
    lua_pushvalue(L, 1);                  // ğŸ“‹ ç›´æ¥ä½¿ç”¨è¯¥å‡½æ•°
  }
}
```

#### ğŸ“ setfenvå‡½æ•°çš„ç¯å¢ƒè®¾ç½®
```c
/* ğŸ“ è®¾ç½®å‡½æ•°ç¯å¢ƒ */
static int luaB_setfenv (lua_State *L) {
  /*
  setfenvçš„ç¯å¢ƒæ§åˆ¶æœºåˆ¶ï¼š
  
  1. ğŸ¯ ç¯å¢ƒéªŒè¯ï¼šç¡®ä¿æ–°ç¯å¢ƒæ˜¯æœ‰æ•ˆçš„è¡¨
  2. ğŸ” å¯¹è±¡å®šä½ï¼šæ”¯æŒå‡½æ•°å’Œçº¿ç¨‹çš„ç¯å¢ƒè®¾ç½®
  3. ğŸ›¡ï¸ æƒé™æ£€æŸ¥ï¼šæŸäº›å¯¹è±¡ä¸å…è®¸ç¯å¢ƒä¿®æ”¹
  4. ğŸ”„ åŸå­æ“ä½œï¼šç¯å¢ƒè®¾ç½®è¦ä¹ˆæˆåŠŸè¦ä¹ˆå¤±è´¥
  */
  
  luaL_checktype(L, 2, LUA_TTABLE);      // ğŸ¯ ç¡®ä¿æ–°ç¯å¢ƒæ˜¯è¡¨
  getfunc(L);                            // ğŸ” è·å–ç›®æ ‡å‡½æ•°
  lua_pushvalue(L, 2);                   // ğŸ“‹ æ¨å…¥æ–°ç¯å¢ƒ
  
  if (lua_isnumber(L, 1) && lua_tonumber(L, 1) == 0) {
    /* ğŸ¯ ç‰¹æ®Šæƒ…å†µï¼šè®¾ç½®å½“å‰çº¿ç¨‹çš„ç¯å¢ƒ */
    lua_pushthread(L);                   // ğŸ“Š æ¨å…¥å½“å‰çº¿ç¨‹
    lua_insert(L, -2);                   // ğŸ”„ è°ƒæ•´æ ˆé¡ºåº
    lua_setfenv(L, -2);                  // ğŸŒ è®¾ç½®çº¿ç¨‹ç¯å¢ƒ
    return 0;                            // ğŸ”š æ— è¿”å›å€¼
  }
  else if (lua_iscfunction(L, -2) ||     // ğŸ” Cå‡½æ•°æˆ–è®¾ç½®å¤±è´¥ï¼Ÿ
           lua_setfenv(L, -2) == 0)
    luaL_error(L,
          LUA_QL("setfenv") " cannot change environment of given object");
          
  return 1;                              // ğŸ“¤ è¿”å›å‡½æ•°å¯¹è±¡
}
```

### ğŸ­ å…ƒç¼–ç¨‹é«˜çº§åº”ç”¨æ¨¡å¼

#### ğŸ—ï¸ ä»£ç†æ¨¡å¼å®ç°
```mermaid
graph TB
    subgraph "ğŸ­ Luaä»£ç†æ¨¡å¼æ¶æ„"
        A[ğŸ¯ ä»£ç†å¯¹è±¡] --> B[ğŸ“‹ å…ƒè¡¨]
        
        B --> C[ğŸ” __indexå…ƒæ–¹æ³•]
        B --> D[ğŸ“ __newindexå…ƒæ–¹æ³•]
        B --> E[ğŸ”§ å…¶ä»–å…ƒæ–¹æ³•]
        
        C --> F[ğŸ“Š å®é™…æ•°æ®å¯¹è±¡]
        D --> F
        
        G[ğŸ’¡ åº”ç”¨åœºæ™¯] --> H[ğŸ”’ è®¿é—®æ§åˆ¶]
        G --> I[ğŸ“Š æ•°æ®éªŒè¯]
        G --> J[ğŸ“ æ“ä½œæ—¥å¿—]
        G --> K[ğŸ¯ æ‡’åŠ è½½]
    end
    
    style A fill:#e3f2fd
    style F fill:#c8e6c9
    style G fill:#fff3e0
```

#### ğŸ› ï¸ å®é™…åº”ç”¨ç¤ºä¾‹
```lua
-- ğŸ­ åˆ›å»ºä¸€ä¸ªå±æ€§éªŒè¯ä»£ç†
function create_validated_object(schema)
    local data = {}
    local proxy = {}
    
    setmetatable(proxy, {
        __index = function(t, k)
            return rawget(data, k)
        end,
        
        __newindex = function(t, k, v)
            -- ğŸ” éªŒè¯å±æ€§
            if schema[k] then
                local validator = schema[k]
                if type(validator) == "function" then
                    if not validator(v) then
                        error("Invalid value for " .. k)
                    end
                elseif type(validator) == "string" then
                    if type(v) ~= validator then
                        error("Expected " .. validator .. " for " .. k)
                    end
                end
            end
            rawset(data, k, v)
        end
    })
    
    return proxy
end

-- ä½¿ç”¨ç¤ºä¾‹
local person_schema = {
    name = "string",
    age = function(v) return type(v) == "number" and v > 0 end
}

local person = create_validated_object(person_schema)
person.name = "Alice"  -- âœ… æˆåŠŸ
person.age = 25        -- âœ… æˆåŠŸ
-- person.age = -5     -- âŒ é”™è¯¯ï¼šInvalid value for age
```

## âš¡ æ€§èƒ½ä¼˜åŒ–ä¸é«˜çº§åº”ç”¨

### ğŸ—‘ï¸ åƒåœ¾å›æ”¶æ§åˆ¶æœºåˆ¶

åƒåœ¾å›æ”¶æ§åˆ¶æ˜¯Luaæ€§èƒ½è°ƒä¼˜çš„å…³é”®å·¥å…·ï¼Œ`collectgarbage`å‡½æ•°æä¾›äº†ç²¾ç»†çš„GCæ§åˆ¶èƒ½åŠ›ï¼š

#### ğŸ—‘ï¸ collectgarbageå‡½æ•°æ·±åº¦è§£æ
```c
/* ğŸ—‘ï¸ åƒåœ¾å›æ”¶æ§åˆ¶çš„å®Œæ•´å®ç° */
static int luaB_collectgarbage (lua_State *L) {
  /*
  collectgarbageçš„æ§åˆ¶ç­–ç•¥ï¼š
  
  1. ğŸšï¸ å¤šæ¨¡å¼æ”¯æŒï¼šæä¾›å¤šç§GCæ§åˆ¶é€‰é¡¹
  2. ğŸ“Š çŠ¶æ€æŸ¥è¯¢ï¼šæ”¯æŒå†…å­˜ä½¿ç”¨é‡æŸ¥è¯¢
  3. ğŸ”§ å‚æ•°è°ƒèŠ‚ï¼šå…è®¸è°ƒæ•´GCå‚æ•°
  4. âš¡ æ€§èƒ½æ§åˆ¶ï¼šç²¾ç¡®æ§åˆ¶åƒåœ¾å›æ”¶æ—¶æœº
  */
  
  static const char *const opts[] = {
    "stop", "restart", "collect", "count", "step", 
    "setpause", "setstepmul", NULL
  };
  static const int optsnum[] = {
    LUA_GCSTOP, LUA_GCRESTART, LUA_GCCOLLECT,
    LUA_GCCOUNT, LUA_GCSTEP, LUA_GCSETPAUSE, LUA_GCSETSTEPMUL
  };
  
  int o = luaL_checkoption(L, 1, "collect", opts);  // ğŸ¯ è·å–æ“ä½œé€‰é¡¹
  int ex = luaL_optint(L, 2, 0);                   // ğŸ“Š è·å–é¢å¤–å‚æ•°
  int res = lua_gc(L, optsnum[o], ex);             // ğŸ”§ æ‰§è¡ŒGCæ“ä½œ
  
  switch (optsnum[o]) {
    case LUA_GCCOUNT: {
      /* ğŸ“Š å†…å­˜ç»Ÿè®¡ï¼šè¿”å›KBä¸ºå•ä½çš„å†…å­˜ä½¿ç”¨é‡ */
      int b = lua_gc(L, LUA_GCCOUNTB, 0);          // ğŸ” è·å–å­—èŠ‚éƒ¨åˆ†
      lua_pushnumber(L, res + ((lua_Number)b/1024)); // ğŸ“‹ åˆå¹¶KBå’Œå­—èŠ‚
      return 1;
    }
    case LUA_GCSTEP: {
      /* ğŸ”„ æ­¥è¿›å¼GCï¼šè¿”å›æ˜¯å¦å®Œæˆä¸€ä¸ªå›æ”¶å‘¨æœŸ */
      lua_pushboolean(L, res);
      return 1;
    }
    default: {
      /* ğŸ”§ å…¶ä»–æ“ä½œï¼šè¿”å›æ•´æ•°ç»“æœ */
      lua_pushinteger(L, res);
      return 1;
    }
  }
}
```

#### ğŸ›ï¸ GCæ§åˆ¶é€‰é¡¹è¯¦è§£
```mermaid
graph TB
    subgraph "ğŸ—‘ï¸ Luaåƒåœ¾å›æ”¶æ§åˆ¶é€‰é¡¹"
        A[ğŸšï¸ GCæ§åˆ¶å‘½ä»¤] --> B[â¹ï¸ stop - åœæ­¢GC]
        A --> C[â–¶ï¸ restart - é‡å¯GC]
        A --> D[ğŸ”„ collect - æ‰§è¡Œå®Œæ•´GC]
        A --> E[ğŸ“Š count - æŸ¥è¯¢å†…å­˜ä½¿ç”¨]
        A --> F[ğŸ‘£ step - æ‰§è¡ŒGCæ­¥éª¤]
        A --> G[â¸ï¸ setpause - è®¾ç½®æš‚åœæ¯”]
        A --> H[ğŸ“ˆ setstepmul - è®¾ç½®æ­¥è¿›å€æ•°]
        
        I[âš¡ æ€§èƒ½è°ƒä¼˜] --> J[ğŸ¯ å†…å­˜æ§åˆ¶]
        I --> K[â±ï¸ å»¶è¿Ÿæ§åˆ¶]
        I --> L[ğŸ“Š ç›‘æ§è¯Šæ–­]
    end
    
    style A fill:#e3f2fd
    style I fill:#c8e6c9
```

#### ğŸ¯ GCæ€§èƒ½è°ƒä¼˜ç­–ç•¥
```lua
-- ğŸ›ï¸ åƒåœ¾å›æ”¶æ€§èƒ½è°ƒä¼˜ç¤ºä¾‹

-- ğŸ“Š ç›‘æ§å†…å­˜ä½¿ç”¨
function monitor_memory()
    local before = collectgarbage("count")
    print(string.format("Memory usage: %.2f KB", before))
    return before
end

-- âš¡ é«˜æ€§èƒ½åœºæ™¯çš„GCç­–ç•¥
function performance_critical_section()
    -- ğŸ›‘ ä¸´æ—¶åœæ­¢GCï¼Œé¿å…å»¶è¿Ÿ
    collectgarbage("stop")
    
    -- ğŸš€ æ‰§è¡Œæ€§èƒ½å…³é”®ä»£ç 
    for i = 1, 1000000 do
        -- å¤§é‡è®¡ç®—...
    end
    
    -- â–¶ï¸ é‡å¯GCå¹¶æ‰§è¡Œä¸€æ¬¡å®Œæ•´å›æ”¶
    collectgarbage("restart")
    collectgarbage("collect")
end

-- ğŸšï¸ æ¸¸æˆå¾ªç¯ä¸­çš„GCç®¡ç†
function game_loop()
    local frame_count = 0
    
    while running do
        -- ğŸ® æ¸¸æˆé€»è¾‘
        update_game()
        render_frame()
        
        frame_count = frame_count + 1
        
        -- ğŸ“Š å®šæœŸæ‰§è¡Œå¢é‡GC
        if frame_count % 60 == 0 then  -- æ¯ç§’ä¸€æ¬¡
            collectgarbage("step", 200)  -- æ‰§è¡Œå°‘é‡GCå·¥ä½œ
        end
        
        -- ğŸ”„ å…³å¡ç»“æŸæ—¶å®Œæ•´å›æ”¶
        if level_completed then
            collectgarbage("collect")
        end
    end
end

-- ğŸ”§ åŠ¨æ€GCå‚æ•°è°ƒæ•´
function optimize_gc_for_workload(memory_pressure)
    if memory_pressure == "high" then
        -- ğŸ”´ é«˜å†…å­˜å‹åŠ›ï¼šæ›´æ¿€è¿›çš„GC
        collectgarbage("setpause", 100)     -- æš‚åœæ¯”100%
        collectgarbage("setstepmul", 300)   -- æ­¥è¿›å€æ•°300%
    elseif memory_pressure == "low" then
        -- ğŸŸ¢ ä½å†…å­˜å‹åŠ›ï¼šæ›´å®½æ¾çš„GC
        collectgarbage("setpause", 200)     -- æš‚åœæ¯”200%
        collectgarbage("setstepmul", 200)   -- æ­¥è¿›å€æ•°200%
    else
        -- ğŸŸ¡ é»˜è®¤è®¾ç½®
        collectgarbage("setpause", 200)
        collectgarbage("setstepmul", 200)
    end
end
```

### ğŸ“Š æ€§èƒ½ä¼˜åŒ–å®è·µæŒ‡å—

#### âš¡ åŸºç¡€åº“å‡½æ•°æ€§èƒ½å¯¹æ¯”
```c
/* ğŸ“Š æ€§èƒ½æµ‹è¯•åŸºå‡†å‡½æ•° */
static void benchmark_base_functions() {
    /*
    åŸºç¡€åº“å‡½æ•°æ€§èƒ½ç‰¹å¾ï¼š
    
    ğŸŸ¢ é«˜æ€§èƒ½å‡½æ•°ï¼ˆå¾®ç§’çº§ï¼‰ï¼š
    - type(): ç›´æ¥ç±»å‹æ£€æŸ¥ï¼Œæ— é¢å¤–å¼€é”€
    - rawget/rawset(): ç›´æ¥è¡¨æ“ä½œï¼Œç»•è¿‡å…ƒæ–¹æ³•
    - rawequal(): ç›´æ¥å€¼æ¯”è¾ƒï¼Œæ— å…ƒæ–¹æ³•è°ƒç”¨
    
    ğŸŸ¡ ä¸­ç­‰æ€§èƒ½å‡½æ•°ï¼ˆæ¯«ç§’çº§ï¼‰ï¼š
    - tostring(): å¯èƒ½è°ƒç”¨å…ƒæ–¹æ³•ï¼Œå­—ç¬¦ä¸²åˆ›å»ºå¼€é”€
    - tonumber(): å­—ç¬¦ä¸²è§£æå¼€é”€ï¼Œè¿›åˆ¶è½¬æ¢è®¡ç®—
    - next/pairs(): è¡¨éå†å¼€é”€ï¼Œè¿­ä»£å™¨åˆ›å»º
    
    ğŸ”´ æ½œåœ¨é«˜å¼€é”€å‡½æ•°ï¼š
    - print(): I/Oæ“ä½œï¼Œæ ¼å¼åŒ–å¼€é”€
    - pcall/xpcall(): å¼‚å¸¸å¤„ç†æœºåˆ¶å¼€é”€
    - collectgarbage(): GCæ“ä½œï¼Œå†…å­˜ç®¡ç†å¼€é”€
    */
}
```

#### ğŸ¯ æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ
```mermaid
graph TB
    subgraph "âš¡ LuaåŸºç¡€åº“æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"
        A[ğŸ¯ å‡½æ•°é€‰æ‹©ä¼˜åŒ–] --> A1[ğŸš€ ä¼˜å…ˆä½¿ç”¨rawgetè€Œéæ™®é€šè®¿é—®]
        A --> A2[ğŸ“Š ç¼“å­˜typeæ£€æŸ¥ç»“æœ]
        A --> A3[âš¡ é¿å…é¢‘ç¹tostringè°ƒç”¨]
        
        B[ğŸ”„ å¾ªç¯ä¼˜åŒ–] --> B1[ğŸ“‹ é¢„å…ˆè·å–å‡½æ•°å¼•ç”¨]
        B --> B2[ğŸ’¾ å¤ç”¨ä¸´æ—¶å¯¹è±¡]
        B --> B3[ğŸ¯ å‡å°‘å…ƒæ–¹æ³•è§¦å‘]
        
        C[ğŸ’¾ å†…å­˜ç®¡ç†] --> C1[ğŸ—‘ï¸ ä¸»åŠ¨GCæ§åˆ¶]
        C --> C2[ğŸ“Š å†…å­˜ä½¿ç”¨ç›‘æ§]
        C --> C3[ğŸ”„ å¯¹è±¡æ± åŒ–æŠ€æœ¯]
        
        D[ğŸš¨ é”™è¯¯å¤„ç†ä¼˜åŒ–] --> D1[ğŸ›¡ï¸ åˆç†ä½¿ç”¨pcall]
        D --> D2[ğŸ“‹ é¢„éªŒè¯å‚æ•°]
        D --> D3[âš¡ å¿«é€Ÿå¤±è´¥ç­–ç•¥]
    end
    
    style A fill:#c8e6c9
    style B fill:#fff3e0
    style C fill:#ffecb3
    style D fill:#ffcdd2
```

### ğŸ—ï¸ å®æˆ˜åº”ç”¨æ¨¡å¼

#### ğŸ­ é«˜çº§å…ƒç¼–ç¨‹æ¨¡å¼
```lua
-- ğŸ—ï¸ åˆ›å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„OOPç³»ç»Ÿ
local Class = {}
Class.__index = Class

function Class:new(...)
    local instance = setmetatable({}, self)
    if instance.init then
        instance:init(...)
    end
    return instance
end

function Class:extend()
    local subclass = setmetatable({}, {__index = self})
    subclass.__index = subclass
    return subclass
end

-- ä½¿ç”¨ç¤ºä¾‹
local Animal = Class:extend()

function Animal:init(name)
    self.name = name
end

function Animal:speak()
    print(self.name .. " makes a sound")
end

local Dog = Animal:extend()

function Dog:speak()
    print(self.name .. " barks")
end

local dog = Dog:new("Buddy")
dog:speak()  -- è¾“å‡º: Buddy barks
```

#### ğŸ”’ å®‰å…¨æ²™ç®±å®ç°
```lua
-- ğŸ”’ åˆ›å»ºå®‰å…¨çš„ä»£ç æ‰§è¡Œç¯å¢ƒ
function create_sandbox()
    local sandbox_env = {
        -- ğŸŸ¢ å…è®¸çš„å®‰å…¨å‡½æ•°
        print = print,
        type = type,
        tostring = tostring,
        tonumber = tonumber,
        pairs = pairs,
        ipairs = ipairs,
        next = next,
        
        -- ğŸ“Š å—é™çš„æ•°å­¦å’Œå­—ç¬¦ä¸²åº“
        math = {
            abs = math.abs, ceil = math.ceil, floor = math.floor,
            max = math.max, min = math.min, sqrt = math.sqrt
        },
        string = {
            len = string.len, sub = string.sub, 
            upper = string.upper, lower = string.lower
        },
        
        -- ğŸš« ç¦æ­¢çš„å±é™©å‡½æ•°è¢«ç§»é™¤
        -- os, io, debug, loadstring, dofile, loadfile ç­‰
    }
    
    return sandbox_env
end

-- ğŸ›¡ï¸ å®‰å…¨æ‰§è¡Œç”¨æˆ·ä»£ç 
function safe_execute(code, timeout)
    local sandbox = create_sandbox()
    
    -- ğŸ“ ç¼–è¯‘ä»£ç 
    local func, err = loadstring(code)
    if not func then
        return false, "Compilation error: " .. err
    end
    
    -- ğŸŒ è®¾ç½®å®‰å…¨ç¯å¢ƒ
    setfenv(func, sandbox)
    
    -- â° è¶…æ—¶ä¿æŠ¤æ‰§è¡Œ
    local success, result = pcall(func)
    
    if success then
        return true, result
    else
        return false, "Runtime error: " .. result
    end
end
```

#### ğŸ“Š æ€§èƒ½ç›‘æ§å·¥å…·
```lua
-- ğŸ“Š åŸºç¡€åº“å‡½æ•°æ€§èƒ½åˆ†æå™¨
local Profiler = {}

function Profiler:new()
    return setmetatable({
        stats = {},
        start_time = nil
    }, {__index = self})
end

function Profiler:start_timing(name)
    self.start_time = os.clock()
    if not self.stats[name] then
        self.stats[name] = {count = 0, total_time = 0}
    end
end

function Profiler:end_timing(name)
    if self.start_time then
        local elapsed = os.clock() - self.start_time
        local stat = self.stats[name]
        stat.count = stat.count + 1
        stat.total_time = stat.total_time + elapsed
        self.start_time = nil
    end
end

function Profiler:report()
    print("Performance Report:")
    print("Function\t\tCount\tTotal(s)\tAvg(ms)")
    for name, stat in pairs(self.stats) do
        local avg_ms = (stat.total_time / stat.count) * 1000
        print(string.format("%-20s\t%d\t%.4f\t\t%.2f", 
              name, stat.count, stat.total_time, avg_ms))
    end
end

-- ä½¿ç”¨ç¤ºä¾‹
local profiler = Profiler:new()

profiler:start_timing("type_check")
for i = 1, 100000 do
    local t = type(i)
end
profiler:end_timing("type_check")

profiler:start_timing("tostring_convert")
for i = 1, 100000 do
    local s = tostring(i)
end
profiler:end_timing("tostring_convert")

profiler:report()
```

## ğŸŒŸ å®æˆ˜åº”ç”¨ä¸æ‰©å±•å¼€å‘

### ğŸ“ æŠ€èƒ½å‘å±•è·¯å¾„

#### ğŸŒ± åˆå­¦è€…è·¯å¾„ (â±ï¸ 6-8å°æ—¶)
```mermaid
graph TB
    subgraph "ğŸ¯ åŸºç¡€åº“å…¥é—¨å­¦ä¹ è·¯å¾„"
        A[ğŸ“– åŸºç¡€æ¦‚å¿µå­¦ä¹ ] --> B[ğŸ”§ å¸¸ç”¨å‡½æ•°æŒæ¡]
        B --> C[ğŸ® ç®€å•é¡¹ç›®å®è·µ]
        C --> D[ğŸ” è°ƒè¯•æŠ€èƒ½åŸ¹å…»]
        
        E[ğŸ“Š ç±»å‹ç³»ç»Ÿ] --> F[ğŸš¨ é”™è¯¯å¤„ç†]
        F --> G[ğŸ“¤ è¾“å‡ºè°ƒè¯•]
        
        H[ğŸ’» å®è·µé¡¹ç›®] --> I[ğŸ§® è®¡ç®—å™¨ç¨‹åº]
        I --> J[ğŸ“‹ æ•°æ®éªŒè¯å·¥å…·]
    end
    
    style A fill:#e8f5e8
    style J fill:#fff3e0
```

**å­¦ä¹ æ£€æŸ¥ç‚¹ï¼š**
- âœ… ç†Ÿç»ƒä½¿ç”¨typeã€tostringã€tonumberç­‰åŸºç¡€å‡½æ•°
- âœ… æŒæ¡printè°ƒè¯•å’ŒassertéªŒè¯æŠ€å·§
- âœ… ç†è§£pcallé”™è¯¯å¤„ç†çš„é‡è¦æ€§
- âœ… èƒ½å¤Ÿç¼–å†™ç®€å•çš„æ•°æ®å¤„ç†ç¨‹åº

#### ğŸš€ ä¸­çº§å¼€å‘è·¯å¾„ (â±ï¸ 12-15å°æ—¶)
```mermaid
graph TB
    subgraph "âš¡ åŸºç¡€åº“è¿›é˜¶å­¦ä¹ è·¯å¾„"
        A[ğŸ­ å…ƒç¼–ç¨‹å…¥é—¨] --> B[ğŸ”„ è¿­ä»£å™¨æŒæ¡]
        B --> C[ğŸŒ ç¯å¢ƒç®¡ç†]
        C --> D[âš¡ æ€§èƒ½ä¼˜åŒ–]
        
        E[ğŸ—ï¸ è®¾è®¡æ¨¡å¼] --> F[ğŸ”’ å®‰å…¨ç¼–ç¨‹]
        F --> G[ğŸ“Š æ€§èƒ½åˆ†æ]
        
        H[ğŸ’¡ é«˜çº§é¡¹ç›®] --> I[ğŸ­ OOPæ¡†æ¶è®¾è®¡]
        I --> J[ğŸ”’ æ²™ç®±ç³»ç»Ÿ]
        J --> K[ğŸ“Š æ€§èƒ½ç›‘æ§å·¥å…·]
    end
    
    style A fill:#e3f2fd
    style K fill:#f3e5f5
```

**èƒ½åŠ›æ£€æŸ¥ç‚¹ï¼š**
- âœ… æŒæ¡å…ƒè¡¨å’Œå…ƒæ–¹æ³•çš„ä½¿ç”¨
- âœ… ç†è§£rawget/rawsetçš„åº”ç”¨åœºæ™¯
- âœ… èƒ½å¤Ÿå®ç°å¤æ‚çš„è¿­ä»£å™¨æ¨¡å¼
- âœ… å…·å¤‡æ€§èƒ½è°ƒä¼˜å’Œå†…å­˜ç®¡ç†èƒ½åŠ›

#### ğŸ† ä¸“å®¶çº§è·¯å¾„ (â±ï¸ 20-25å°æ—¶)
```mermaid
graph TB
    subgraph "ğŸ† åŸºç¡€åº“ä¸“å®¶çº§è·¯å¾„"
        A[ğŸ§  æ·±åº¦åŸç†ç†è§£] --> B[ğŸ”§ åº•å±‚å®ç°åˆ†æ]
        B --> C[ğŸ¨ åˆ›æ–°åº”ç”¨å¼€å‘]
        C --> D[ğŸ“– çŸ¥è¯†ä¼ æˆ]
        
        E[ğŸŒ ç”Ÿæ€è´¡çŒ®] --> F[ğŸ“š åº“å¼€å‘]
        F --> G[ğŸ”§ å·¥å…·é“¾å»ºè®¾]
        
        H[ğŸ“ æŠ€æœ¯é¢†å¯¼] --> I[ğŸ¯ æ¶æ„è®¾è®¡]
        I --> J[ğŸ“‹ æ ‡å‡†åˆ¶å®š]
    end
    
    style A fill:#fce4ec
    style J fill:#e8f5e8
```

### ğŸ”— æ–‡æ¡£äº¤å‰å¼•ç”¨

#### ğŸ“‹ ç›¸å…³æ ¸å¿ƒæ–‡æ¡£
- ğŸ¯ **[Luaæ‰§è¡Œæµç¨‹åˆ†æ](wiki_execution_optimized.md)** - ç†è§£åŸºç¡€åº“åœ¨æ‰§è¡Œæµç¨‹ä¸­çš„ä½œç”¨
- ğŸ”¤ **[è¯æ³•åˆ†æå™¨è¯¦è§£](wiki_lexer_optimized.md)** - äº†è§£ç±»å‹ç³»ç»Ÿçš„åº•å±‚æ”¯æŒ
- ğŸ”§ **[å‡½æ•°ç³»ç»Ÿæ·±åº¦è§£æ](wiki_function_optimized.md)** - æ·±å…¥ç†è§£å‡½æ•°ç¯å¢ƒå’Œé—­åŒ…
- ğŸ—„ï¸ **[å†…å­˜ç®¡ç†æœºåˆ¶](wiki_memory.md)** - åƒåœ¾å›æ”¶æ§åˆ¶çš„åº•å±‚åŸç†
- ğŸ“ **[å­—ç¬¦ä¸²åº“è¯¦è§£](wiki_lib_string.md)** - tostringå‡½æ•°çš„æ‰©å±•åº”ç”¨

#### ğŸ¯ å­¦ä¹ å»ºè®®åºåˆ—
1. **å‰ç½®çŸ¥è¯†**ï¼šå…ˆå­¦ä¹  `wiki_execution_optimized.md` äº†è§£Luaæ•´ä½“æ¶æ„
2. **å¹¶è¡Œå­¦ä¹ **ï¼šå¯ä»¥åŒæ—¶å­¦ä¹  `wiki_function_optimized.md` ç†è§£å‡½æ•°æœºåˆ¶
3. **æ·±åŒ–ç†è§£**ï¼šç»“åˆ `wiki_memory.md` ç†è§£GCæ§åˆ¶åŸç†
4. **æ‰©å±•åº”ç”¨**ï¼šé€šè¿‡ `wiki_lib_string.md` äº†è§£åº“è®¾è®¡æ¨¡å¼

### ğŸ› ï¸ å®è·µç»ƒä¹ é¡¹ç›®

#### ğŸ® é¡¹ç›®1ï¼šæ™ºèƒ½è°ƒè¯•å·¥å…· (éš¾åº¦ï¼šâ­â­)
**ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªå¢å¼ºç‰ˆçš„è°ƒè¯•è¾“å‡ºå·¥å…·

**æŠ€æœ¯è¦æ±‚**ï¼š
- æ”¯æŒåˆ†çº§æ—¥å¿—è¾“å‡º
- è‡ªåŠ¨ç±»å‹æ£€æŸ¥å’Œæ ¼å¼åŒ–
- æ€§èƒ½ç›‘æ§åŠŸèƒ½

**æ ¸å¿ƒä»£ç ç»“æ„**ï¼š
```lua
-- ğŸ› ï¸ æ™ºèƒ½è°ƒè¯•å·¥å…·å®ç°
local Debug = {
    levels = {ERROR = 1, WARN = 2, INFO = 3, DEBUG = 4},
    current_level = 3,
    stats = {}
}

function Debug:log(level, ...)
    if self.levels[level] <= self.current_level then
        local args = {...}
        local formatted = {}
        
        for i, v in ipairs(args) do
            table.insert(formatted, tostring(v) .. " (" .. type(v) .. ")")
        end
        
        print("[" .. level .. "]", table.concat(formatted, " "))
        
        -- ç»Ÿè®¡è®°å½•
        self.stats[level] = (self.stats[level] or 0) + 1
    end
end

-- ä½¿ç”¨ç¤ºä¾‹
Debug:log("INFO", "Processing data:", {x=1, y=2}, 42)
-- è¾“å‡º: [INFO] Processing data: table: 0x... (table) 42 (number)
```

**è¯„ä¼°æ ‡å‡†**ï¼š
- âœ… å®ç°å®Œæ•´çš„åˆ†çº§æ—¥å¿—åŠŸèƒ½
- âœ… è‡ªåŠ¨ç±»å‹è¯†åˆ«å’Œæ ¼å¼åŒ–
- âœ… æ€§èƒ½ç»Ÿè®¡å’Œç›‘æ§

#### âš¡ é¡¹ç›®2ï¼šé«˜æ€§èƒ½å¯¹è±¡æ±  (éš¾åº¦ï¼šâ­â­â­)
**ç›®æ ‡**ï¼šå®ç°ä¸€ä¸ªåŸºäºåŸºç¡€åº“çš„é«˜æ€§èƒ½å¯¹è±¡æ± ç³»ç»Ÿ

**æŠ€æœ¯è¦æ±‚**ï¼š
- ä½¿ç”¨rawset/rawgetä¼˜åŒ–æ€§èƒ½
- é›†æˆåƒåœ¾å›æ”¶æ§åˆ¶
- æä¾›è¯¦ç»†çš„ä½¿ç”¨ç»Ÿè®¡

**æ ¸å¿ƒè®¾è®¡**ï¼š
```lua
-- âš¡ é«˜æ€§èƒ½å¯¹è±¡æ± å®ç°
local ObjectPool = {}

function ObjectPool:new(factory, reset_func, initial_size)
    local pool = {
        factory = factory or function() return {} end,
        reset = reset_func or function(obj) 
            -- æ¸…ç†å¯¹è±¡çŠ¶æ€
            for k in pairs(obj) do rawset(obj, k, nil) end
        end,
        available = {},
        in_use = {},
        stats = {created = 0, reused = 0, peak_usage = 0}
    }
    
    -- é¢„å¡«å……æ± 
    for i = 1, (initial_size or 10) do
        local obj = pool.factory()
        table.insert(pool.available, obj)
        pool.stats.created = pool.stats.created + 1
    end
    
    return setmetatable(pool, {__index = self})
end

function ObjectPool:acquire()
    local obj
    if #self.available > 0 then
        obj = table.remove(self.available)
        self.stats.reused = self.stats.reused + 1
    else
        obj = self.factory()
        self.stats.created = self.stats.created + 1
    end
    
    rawset(self.in_use, obj, true)
    local current_usage = 0
    for _ in pairs(self.in_use) do current_usage = current_usage + 1 end
    self.stats.peak_usage = math.max(self.stats.peak_usage, current_usage)
    
    return obj
end

function ObjectPool:release(obj)
    if rawget(self.in_use, obj) then
        rawset(self.in_use, obj, nil)
        self.reset(obj)
        table.insert(self.available, obj)
        return true
    end
    return false
end
```

**è¯„ä¼°æ ‡å‡†**ï¼š
- âœ… æ˜¾è‘—çš„æ€§èƒ½æå‡ï¼ˆç›¸æ¯”ç›´æ¥åˆ›å»ºå¯¹è±¡ï¼‰
- âœ… å‡†ç¡®çš„ä½¿ç”¨ç»Ÿè®¡å’Œç›‘æ§
- âœ… è‰¯å¥½çš„å†…å­˜ç®¡ç†å’ŒGCå‹å¥½æ€§

#### ğŸ† é¡¹ç›®3ï¼šå…ƒç¼–ç¨‹DSLæ¡†æ¶ (éš¾åº¦ï¼šâ­â­â­â­)
**ç›®æ ‡**ï¼šåˆ›å»ºä¸€ä¸ªåŸºäºå…ƒè¡¨çš„é¢†åŸŸç‰¹å®šè¯­è¨€æ¡†æ¶

**æŠ€æœ¯è¦æ±‚**ï¼š
- æ·±åº¦ä½¿ç”¨å…ƒè¡¨å’Œç¯å¢ƒç®¡ç†
- å®ç°ç±»ä¼¼SQLçš„å£°æ˜å¼è¯­æ³•
- æä¾›å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œè°ƒè¯•æ”¯æŒ

**è®¾è®¡ç¤ºä¾‹**ï¼š
```lua
-- ğŸ† DSLæŸ¥è¯¢è¯­è¨€å®ç°
local QueryBuilder = {}

function QueryBuilder:new(data)
    local builder = {
        _data = data,
        _conditions = {},
        _transforms = {}
    }
    
    return setmetatable(builder, {
        __index = function(t, k)
            -- åŠ¨æ€æ–¹æ³•ç”Ÿæˆ
            if k:match("^where_") then
                local field = k:sub(7)  -- ç§»é™¤"where_"å‰ç¼€
                return function(self, value)
                    table.insert(self._conditions, {field, "=", value})
                    return self
                end
            elseif k:match("^select_") then
                local field = k:sub(8)  -- ç§»é™¤"select_"å‰ç¼€  
                return function(self)
                    table.insert(self._transforms, function(row) return row[field] end)
                    return self
                end
            else
                return rawget(QueryBuilder, k)
            end
        end
    })
end

-- ä½¿ç”¨ç¤ºä¾‹
local users = {
    {name = "Alice", age = 25, city = "NYC"},
    {name = "Bob", age = 30, city = "LA"},
    {name = "Charlie", age = 25, city = "NYC"}
}

local result = QueryBuilder:new(users)
    :where_age(25)
    :where_city("NYC")
    :select_name()
    :execute()
-- ç»“æœ: {"Alice", "Charlie"}
```

### ğŸ“Š å­¦ä¹ è¯„ä¼°ä½“ç³»

#### ğŸ¯ ç†è®ºçŸ¥è¯†æµ‹è¯•
**åŸºç¡€æ¦‚å¿µ** (æ€»åˆ†30åˆ†)
- åŸºç¡€åº“å‡½æ•°åˆ†ç±»å’Œç”¨é€” (8åˆ†)
- ç±»å‹ç³»ç»Ÿå’Œè½¬æ¢æœºåˆ¶ (7åˆ†)  
- é”™è¯¯å¤„ç†å’Œè°ƒè¯•æŠ€å·§ (8åˆ†)
- æ€§èƒ½ç‰¹å¾å’Œä¼˜åŒ–ç­–ç•¥ (7åˆ†)

**é«˜çº§ç†è§£** (æ€»åˆ†30åˆ†)
- å…ƒç¼–ç¨‹æœºåˆ¶å’Œåº”ç”¨ (10åˆ†)
- ç¯å¢ƒç®¡ç†å’Œå®‰å…¨æ€§ (10åˆ†)
- åƒåœ¾å›æ”¶æ§åˆ¶åŸç† (10åˆ†)

#### ğŸ’» å®è·µèƒ½åŠ›è¯„ä¼°
**ç¼–ç¨‹å®ç°** (æ€»åˆ†25åˆ†)
- ä»£ç è´¨é‡å’Œè®¾è®¡ (8åˆ†)
- åŠŸèƒ½å®Œæ•´æ€§ (8åˆ†)
- æ€§èƒ½ä¼˜åŒ–æ•ˆæœ (9åˆ†)

**é—®é¢˜è§£å†³** (æ€»åˆ†15åˆ†)
- è°ƒè¯•å’Œè¯Šæ–­èƒ½åŠ› (8åˆ†)
- åˆ›æ–°åº”ç”¨è®¾è®¡ (7åˆ†)

### ğŸŒŸ è¿›é˜¶å­¦ä¹ æ–¹å‘

#### ğŸ”¬ Luaå†…æ ¸å¼€å‘
- **æºç è´¡çŒ®**ï¼šå‚ä¸Luaå®˜æ–¹æºç å¼€å‘å’Œç»´æŠ¤
- **Cæ‰©å±•å¼€å‘**ï¼šç¼–å†™é«˜æ€§èƒ½çš„Cæ‰©å±•åº“
- **è™šæ‹Ÿæœºä¼˜åŒ–**ï¼šæ·±å…¥ç ”ç©¶Lua VMæ€§èƒ½ä¼˜åŒ–

#### ğŸ¯ DSLè®¾è®¡ä¸å®ç°
- **é…ç½®è¯­è¨€**ï¼šè®¾è®¡åº”ç”¨ç‰¹å®šçš„é…ç½®DSL
- **æ¨¡æ¿å¼•æ“**ï¼šåŸºäºLuaçš„æ¨¡æ¿å¤„ç†ç³»ç»Ÿ
- **è§„åˆ™å¼•æ“**ï¼šä¸šåŠ¡è§„åˆ™çš„å£°æ˜å¼è¡¨è¾¾

#### ğŸš€ é«˜æ€§èƒ½åº”ç”¨
- **æ¸¸æˆè„šæœ¬**ï¼šé«˜æ€§èƒ½æ¸¸æˆé€»è¾‘è„šæœ¬ç³»ç»Ÿ
- **Webå¼€å‘**ï¼šåŸºäºLuaçš„é«˜å¹¶å‘Webæ¡†æ¶
- **åµŒå…¥å¼ç³»ç»Ÿ**ï¼šèµ„æºå—é™ç¯å¢ƒä¸‹çš„Luaåº”ç”¨

---

## ğŸ‰ æ€»ç»“ä¸å±•æœ›

LuaåŸºç¡€åº“è™½ç„¶ç®€æ´ï¼Œä½†è•´å«ç€æ·±åˆ»çš„è®¾è®¡æ™ºæ…§ã€‚ä»ç²¾å·§çš„ç±»å‹è½¬æ¢æœºåˆ¶ï¼Œåˆ°å¼ºå¤§çš„å…ƒç¼–ç¨‹èƒ½åŠ›ï¼Œå†åˆ°ç²¾ç»†çš„åƒåœ¾å›æ”¶æ§åˆ¶ï¼Œæ¯ä¸ªå‡½æ•°éƒ½ä½“ç°äº†"ç®€æ´è€Œå¼ºå¤§"çš„è®¾è®¡å“²å­¦ã€‚

é€šè¿‡æ·±å…¥å­¦ä¹ åŸºç¡€åº“ï¼Œä½ ä¸ä»…èƒ½æŒæ¡Luaç¼–ç¨‹çš„æ ¸å¿ƒæŠ€èƒ½ï¼Œæ›´èƒ½åŸ¹å…»å‡ºè‰²çš„ç³»ç»Ÿè®¾è®¡æ€ç»´ã€‚è®°ä½ï¼ŒæŠ€æœ¯çš„ç²¾è¿›æ¥è‡ªä¸æ–­çš„å®è·µå’Œæ€è€ƒï¼Œè€ŒåŸºç¡€åº“æ­£æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­æœ€å¯é çš„ä¼™ä¼´ã€‚

### ğŸ“š æ ¸å¿ƒæ”¶è·æ€»ç»“

1. **ğŸ”§ å‡½æ•°æŒæ¡**ï¼šå…¨é¢æŒæ¡25+ä¸ªåŸºç¡€åº“å‡½æ•°çš„ç”¨æ³•å’ŒåŸç†
2. **ğŸ­ å…ƒç¼–ç¨‹æŠ€èƒ½**ï¼šæ·±å…¥ç†è§£å…ƒè¡¨ã€ç¯å¢ƒç®¡ç†ç­‰é«˜çº§ç‰¹æ€§  
3. **âš¡ æ€§èƒ½è°ƒä¼˜**ï¼šæŒæ¡åƒåœ¾å›æ”¶æ§åˆ¶å’Œæ€§èƒ½ä¼˜åŒ–æŠ€å·§
4. **ğŸ—ï¸ è®¾è®¡æ¨¡å¼**ï¼šå­¦ä¼šè¿ç”¨åŸºç¡€åº“æ„å»ºå¤æ‚çš„åº”ç”¨æ¶æ„
5. **ğŸ›¡ï¸ å®‰å…¨æ„è¯†**ï¼šäº†è§£æ²™ç®±å®ç°å’Œå®‰å…¨ç¼–ç¨‹æœ€ä½³å®è·µ

### ğŸš€ æŒç»­å­¦ä¹ å»ºè®®

- ğŸ“ **å®è·µä¸ºç‹**ï¼šé€šè¿‡å®é™…é¡¹ç›®å·©å›ºç†è®ºçŸ¥è¯†
- ğŸ” **æºç é˜…è¯»**ï¼šæ·±å…¥ç ”ç©¶Luaå®˜æ–¹å®ç°
- ğŸŒ **ç¤¾åŒºå‚ä¸**ï¼šåˆ†äº«ç»éªŒï¼Œå­¦ä¹ ä»–äººçš„æœ€ä½³å®è·µ
- ğŸ’¡ **åˆ›æ–°åº”ç”¨**ï¼šå°è¯•å°†åŸºç¡€åº“åº”ç”¨åˆ°æ–°çš„é¢†åŸŸ

æ„¿è¿™ä»½æ–‡æ¡£æˆä¸ºä½ Luaå­¦ä¹ è·¯ä¸Šçš„å¾—åŠ›åŠ©æ‰‹ï¼Œå¼€å¯æ›´å¹¿é˜”çš„ç¼–ç¨‹è§†é‡ï¼

### ğŸ“§ åé¦ˆä¸æ”¹è¿›

å¦‚æœä½ åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰ä»»ä½•ç–‘é—®æˆ–å»ºè®®ï¼Œæ¬¢è¿ï¼š
- ğŸ“ æäº¤å­¦ä¹ å¿ƒå¾—å’Œé¡¹ç›®æ¡ˆä¾‹
- ğŸ› æŠ¥å‘Šæ–‡æ¡£ä¸­çš„é—®é¢˜æˆ–é”™è¯¯  
- ğŸ’¡ åˆ†äº«åˆ›æ–°çš„åº”ç”¨æ€è·¯
- ğŸ¤ å‚ä¸å¼€æºé¡¹ç›®å’ŒæŠ€æœ¯è®¨è®º

**ç¼–ç¨‹è·¯ä¸Šï¼ŒåŸºç¡€ä¸ºæœ¬ï¼Œåˆ›æ–°ä¸ºç¿¼ï¼** ğŸš€

---